<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>CTSC2014 游记 - Zecong Hu&#39;s blog</title>
  <meta name="description" content="说来这是我第二次写游记……也是最后一次了。 退役啦。能走到这一步，竞赛生涯也算是圆满了。CTSC 最后的分数按照分数线也能拿个 Au，十分感动（P神表示他三年都是 Ag）。 下面估计是一堆流水账……如果你不是没事做还是别看了。">

  
  <link rel="stylesheet" href="/assets/styles/core.css?v=20191121014911">
  <link rel="stylesheet" href="/assets/styles/fontello.css?v=20191121014911">
  <link rel="stylesheet" href="/assets/styles/highlighting/default.css?v=20191121014911">

  <link rel="canonical" href="http://zecong.hu/2014/05/01/ctsc2014-travel-notes/">
  <link rel="alternate" type="application/rss+xml" title="Zecong Hu&#39;s blog" href="/feed.xml">

  <link rel="apple-touch-icon" sizes="57x57" href="/assets/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicon/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://unpkg.com/tippy.js@4/themes/light.css">
  <script src="https://unpkg.com/popper.js@1/dist/umd/popper.min.js"></script>
  <script src="https://unpkg.com/tippy.js@4/umd/index.all.min.js"></script>
  

  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      TeX: {
        equationNumbers: {
          autoNumber: "AMS"
        }
      },
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(', '\\)'] ],
        displayMath: [ ['$$','$$'] ],
        processEscapes: true,
      }
    });
  </script>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  

  
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48327586-2', 'auto');
  ga('send', 'pageview');

</script>
  

  
</head>

  <body>

  <main class="page-content" aria-label="Content">
    
    <div id="table-of-contents">
      <div class="toc-wrapper">
        <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#day-0---427">Day 0 - 4.27</a></li>
<li class="toc-entry toc-h2"><a href="#day-1---428">Day 1 - 4.28</a></li>
<li class="toc-entry toc-h2"><a href="#day-15---429">Day 1.5 - 4.29</a></li>
<li class="toc-entry toc-h2"><a href="#day-2---430">Day 2 - 4.30</a></li>
<li class="toc-entry toc-h2"><a href="#day-25---51">Day 2.5 - 5.1</a></li>
<li class="toc-entry toc-h2"><a href="#52">5.2</a></li>
</ul>
      </div>
    </div>
    

    <div class="wrapper">
      <nav class="site-nav">
  
  
  	
  	<a class="page-link" href="/" >About</a>
  	
  
  	
  	<a class="page-link" href="/index/en/index.html" >Articles</a>
  	
  
  	
  	<a class="page-link" href="/index/cn/index.html" >文章列表</a>
  	
  
  	
  
  	
  
</nav>



<article class="post" lang="zh-Hans" itemscope itemtype="http://schema.org/BlogPosting" >

  <header class="post-header">
  <a class="site-title" href="/">
  	
      Zecong Hu&#39;s blog
    
  </a>
  <h1 class="post-title" itemprop="name headline">CTSC2014 游记</h1>
</header>




  <div class="post-content" itemprop="articleBody">
    <p>说来这是我第二次写游记……也是最后一次了。</p>

<p>退役啦。能走到这一步，竞赛生涯也算是圆满了。CTSC 最后的分数按照分数线也能拿个 Au，十分感动（P神表示他三年都是 Ag）。</p>

<p>下面估计是一堆流水账……如果你不是没事做还是别看了。</p>

<!--more-->

<p><br /></p>
<h2 id="day-0---427">Day 0 - 4.27</h2>

<p>我们26号晚上坐Z18来的北京，在火车上看片看到12点，十分开心。第二天火车破天荒晚点了半小时，不过没啥影响。倒腾了一个多小时的地铁终于到了 BUAA，发现住在学校的招待所，一瞬间感觉会神作。领房卡又领了半小时，进了房间之后发现条件挺不错的，比预想的好多了。被分配到和kzf大爷一个房，后来搬过去和隔壁学弟住了，把 kzf 大爷坑到了别的房间。</p>

<p>下午四点试机，我们和俩学弟三点左右到校园里转了一圈，买了瓶脉动，然后在健身器材那块玩了一会儿。去试机的时候发现学弟在怒写算法/数据结构，我敲了个模板，试了下 gedit 的外部工具怎么写，然后打了一会儿俄罗斯方块。</p>

<p>晚上的欢迎晚宴异常丰富，估计上了十几个菜。这或许预示了什么。“吃好点，明天好上路。”</p>

<p>因为第二天还要考试，所以睡得比较早。</p>

<p><br /></p>
<h2 id="day-1---428">Day 1 - 4.28</h2>

<p>早上闹钟还没响就醒来了。醒来发现艳阳高照，以为已经八九点了，惊出一身冷汗。起来一看手机才6点10，安心继续睡了。</p>

<p>由于前一天晚上洗了头，这天早上起来头发简直就是杀马特。花了十来分钟才梳成一个能看的样子。</p>

<p>四楼的早餐感觉一般，这几天早上都没吃什么。</p>

<p>到了机房，发现集训队在一个单独的机房。左边坐着 dhh，右边坐着 wzy，感觉亚历山大。开考前改了时限，原来的时限真是吓死人。看了下配置，发现是8核 i7，顿时优越感爆棚。事后发现别的机房也是 i7。</p>

<p>先看了第一题。“企鹅QQ”。应该不是 qq 出的吧，多半是 cxm？好像是考字符串。CTSC 的字符串题多半不可做，先看了20分暴力，感觉很靠谱。第3个点 $\lvert S\rvert=2$ 的好像可以 bitset 搞。看了下满分数据范围，然后想了想……诶，直接 Hash 不就好了吗？但这是 CTSC 诶，怎么会这么水？于是先记下想法放一边了……</p>

<p>第二题。“天翼牌排插”。应该不是P神出的吧，怎么会自黑呢，要是自己出的话就是在晒妹了啊。想了想，感觉暴力比较可写啊，于是先放一边了。</p>

<p>第三题。“露露”啥的。听说这是黑炫教的，于是我猜应该是 clj 的题。这个啥 Twister 我听说过……不过和这题好像没什么关系。发现5分暴力能做。 $type=1$ 的死活不会，但 $type=0$ 而且 $n\leq 100$ 的好像能矩乘……想了想推出了矩阵，感觉好像没法化简。于是先放一边了。</p>

<p>回去写了第一题，发现 $O(nl\log l)$ 的 Hash 写得十分轻松愉快而且只要跑 2s 左右。加了点常数优化之后就能在 1.8s 跑出来了。之后写了个暴力对拍，大数据一下就错了小数据怎么都不会错。花了大概半个小时调试，结果发现数据生成器写错了，一口老血喷出来。至此第一题估计有100分了，检查了下内存就没管了。</p>

<p>之后跑去写第二题暴力，写了发现死活过不了样例，这才发现电流可以流到两点之间一条链之外的部分……于是弃疗了。物理不及格的伤不起啊。</p>

<p>再然后就跑去写第三题了。先敲了5分的模拟，然后写了矩乘。对于 $x$ 是好的的 $type=0$ 的大数据写了个 bitset 的乱搞做法，感觉如果数据比较水应该能拿几分。后来想出了第二个数据怎么做，然后又用矩乘写了个后面 $type=1$ 的暴力。各种乱搞用 namespace 套起来，最后写了大概有300来行……</p>

<p>离考试结束还有大概一个小时而我已经没事做了……继续检查第一题，弃疗第二题，思考第三题，到了最后也没啥进展。</p>

<p><br /></p>

<p>考完大家都说第一题是水题，于是估计我的做法应该是对的。第二题写出暴力的好像都没几个。第三题也没几个人能拿高分吧。</p>

<p>去吃了个饭，回宾馆逛了下b站，就去看成绩了。100+0+10。看了下第三题的代码，发现最后写 $type=1$ 的暴力用矩乘时把矩乘给改错了擦……加上矩乘部分的分应该有25左右……不过这个分数也还不错，在集训队里好像也能排中等……</p>

<p>lmh 说他第三题拿了100，我去看发现他所有点不是 WA 就是 TLE 但总分就是有100……后来好像复测了，分数和我一样。lxy 第一题悲剧了……只有20分。听说 vfk 有170，吓出**了。</p>

<p>讲题的时候发现第一题就是 qq 出的而且第二题就是P神出的……P神你晒妹丧心病狂啊。第二题做法十分高大上，连暴力分都不给简直丧心病狂（P神：“这个做法是不是很优美。” lxy：“优美是优美，就是感受不到。”）。第三题完全不懂觉厉（P神：“这里写的‘简单的 FFT’。” lxy：“简单是简单，就是听不太懂。”）。第一题是 cxm 来讲的，标程给了个非 Hash 的靠谱做法，不明觉厉。</p>

<p><br /></p>

<p>由于第二天就要答辩了，晚上对着幻灯片练了好几遍。感觉比较有把握了，就去给在看片的 lmh 剧透了。这天同样睡得比较早。不敢晚上洗头了，准备第二天上午洗，反正9点才开始答辩。</p>

<p><br /></p>
<h2 id="day-15---429">Day 1.5 - 4.29</h2>

<p>妈蛋这什么破招待所早上没有热水。进去淋了点水就出来了，喉咙不怎么舒服，感觉要感冒了。</p>

<p>我是第12个答辩的，感觉靠前一点会比较好。我开始以为我的论文会被D，因为实在写的很水。后来发现有和我差不多水的，就安心了。</p>

<p>我平时语速比较快，所以练习的时候就有意识地放慢了语速。但演讲的时候的语速还是偏快的，不过比起没有刻意控制还是要好一些。十分惊讶地发现自己语速快的时候还是可以吐字比较清楚，和练习的时候不太一样。本来是恰好准备了8分钟的幻灯片的，但由于语速有点快好像7分钟左右就讲完了。其实还是挺紧张的，讲到后面手和腿都有点发抖，不知道有没有人看到。</p>

<p>就 cxm 一个人提了问题，问我关于随机算法分类的问题。这个问题我是准备过的，因此直接就回答了。感觉回答得还行。</p>

<p>其实之前王宏他们问的问题感觉有点刁钻……没问我还是比较幸运的。</p>

<p><br /></p>

<p>下午去军事博物馆。抱着不去玩玩太可惜了的态度去了，结果被漫天柳絮糊了一脸。本来是说4点10返回的，结果大家都受不了3点半就回来了……</p>

<p><br /></p>

<p>晚上和俩学弟一起聊了些很重口味的话题……感觉倍儿爽。</p>

<p><br /></p>
<h2 id="day-2---430">Day 2 - 4.30</h2>

<p>考完这场就要退役了，想想还有点小激动呢。</p>

<p>早上肚子不太舒服，7点半左右才去吃早饭。也没吃什么，随便拿了点包点和红薯，倒了杯咖啡。咖啡还准备走在路上的时候喝，结果被自己给打翻了……不能多说。</p>

<p>由于被“剧透”说 Day 2 的题目更变态，所以已经做好了心理准备。我还坐在和 Day 1 一样的位置，但其他人好像换了。我左边是 yxj，右边是 crx，照样亚历山大。</p>

<p>第一题。“小强和阿米巴”。嗯，范爷的丧心病狂题。怎么又是一个什么加密函数，输入文件还是二进制文件？还有 1MB？还不告诉 $N$ 和 $b$ ？提示写的是啥玩意儿？果断看第二题。</p>

<p>第二题尼玛。能说人话吗。看了十来分钟，终于看懂要求什么了。于是就看第三题去了。</p>

<p>第三题好欢乐啊，识别图像里的数字。“B君”，bk 吗。还很贴心地给了个生成 bmp 的程序，好像纯人类智慧从开始打到结束可以 AC 的样子？先放一边吧，去敲第二题暴力。</p>

<p>敲了个第二题30分的暴力，然后继续 YY 了一下，感觉只和 MST 上的边有关。然后写了个贪心，被随机数据卡掉了，就没管了。</p>

<p>再去看第一题，花了半小时终于能正确读入了。开始感觉10分暴力都搞不了，后来发现不用枚举 $K_1$ ，而且 $X$ 整个是确定的。再后来发现可以自然溢出而且根本不用取模，于是改了下常数，10分到手了。</p>

<p>感觉再不做提交答案题就完蛋了，于是去看了看提答。先手打了前100个，和 sample 放在一起写了个程序分析每种数字里黑块的数目和洞的数目。根据狗眼随便特判了一下。开始还不太好意思手打，因为感觉我们机房应该不屑于做这种事情……但后来还是手打了前1000个，然后测试了一下程序，大概有 40% 的正确率。感觉还可以接受，就弃疗了。</p>

<p>之后再回去看了第一题，发现第三个点好像能做。纠结了一会儿，发现是 xor 方程组，写了个调了半天，终于能过了。吐槽一下数据生成器，生成一个要1分钟，太蛋疼了。</p>

<p>出考场估分 20+30+40=90。和 lxy 讨论了下第二题，发现我看错题了，顿时觉累不爱。</p>

<p><br /></p>

<p>由于我们可以提前看成绩，所以吃完饭就去了。一看发现有 20+30+45，第二题奇迹般地拿到了暴力分，十分不科学。</p>

<p>不过还是退役了，意料之中的结局。最后排到了第⑨名，也算是很不错的一个结果了。离国家队还是有差距的，和前几名在水平上差的太多了。hza 和 yxj 有点可惜啊，只差了一两分……</p>

<p>范爷很愉快地对我说退役了赶紧回去享受高中生活，大学累死你。</p>

<p><br /></p>

<p>之后就回宾馆了，和P神愉快地打了一通电话。lmh 和 lxy 去看了成绩，算总分 lmh 只比我低两分……很不爽啊。在宾馆呆到了四点去听讲题，结果发现3点20就开始讲了只听到了第三题……之后喜闻乐见的口试，对我来说槽点大概有</p>

<ol>
  <li>
    <p>绍兴两位大爷口语好像一般……</p>
  </li>
  <li>
    <p>为啥大家都没听懂问的问题呢</p>
  </li>
  <li>
    <p>“据我的了解，you are very good at 演小品。” dzd 英语真厉害</p>
  </li>
  <li>
    <p>那个提问的女老师……英文不好还是用中文问吧……</p>
  </li>
</ol>

<p>再说下去感觉人品会没了……</p>

<p>闭幕式好蛋疼……开始折腾那么久就为了玩两盘2048？颁奖就是一个找熟悉的名字的过程……反正也没有我的奖。</p>

<p>晚上大概12点才睡，不知道为啥就熬到了这个时候。</p>

<p><br /></p>

<p>嘛，总而言之，退役啦。</p>

<p><br /></p>
<h2 id="day-25---51">Day 2.5 - 5.1</h2>

<p><del>这个才是重点我会说嘛</del></p>

<p><br /></p>

<p>前一天受P神之邀去爬山。似乎是一座叫鹫（jiù）峰的奇怪的山。办了退房之后就和 lmh 到北大东门站等P神，还有他一个高中同学。坐了地铁之后转公交，由于是五一黄金周人多得简直丧心病狂。好不容易挤上了公交，站了一个小时发现P神他们都没有下车的迹象……原来这个什么山在这么偏僻的地方？</p>

<p>开到某个地方堵起来了……于是司机开了门许多人都下车了。下车了发现那里有个什么“迷笛音乐节”，一堆留着艺术家发型的人在排队。于是我们就只能走到目的地。</p>

<p>P神表示还没吃早餐，于是准备先去解决中餐。由于那个音乐节，这块地区整个供不应求。一路上我们进了三个餐馆，第一个桌子旁就是液化气罐，而且好像只能有<del>头骨</del>骨头汤火锅而且还得等半个小时；第二个根本没座位；第三个表示只有一个厨子你现在能坐下但是不能点菜。我们只好去附近一个铺子买了烤鸭，然后在旁边一个小吃店点了凉菜和凉粉。但是都没有坐的地方啊。P神表示这都不是事儿，于是带我们回到了开始的第三个餐馆。</p>

<p><br /></p>

<p>P神：“你们现在能点菜了吗？”</p>

<p>老板娘：“还不行呢，前面还有好多桌。”</p>

<p>P神：“哦，那我们在这坐着等着吧。我们自己买了点东西，先在这吃一点。”</p>

<p>老板娘：“行，你们先吃吧。”</p>

<p><br /></p>

<p>………………新技能get√！P神还找老板娘要了四个杯子装我们从外面超市买的饮料……最后垃圾还给老板娘收拾了……真是吓死我了……</p>

<p><br /></p>

<p>由于各种折腾，吃完饭就已经一点半了，一路走了两公里才看到路牌，要爬山肯定是来不及了，于是去了附近的一个寺庙，叫大觉（júe）寺。发现进门还要门票，仔细看了下规定，发现中小学生免票，于是很开心地进去了。</p>

<p>……这寺庙和佛教还有什么关系吗……亮点大概只有里面的百年和千年古树了，槽点倒是有不少。</p>

<p>有一个没上锁的鼓楼，进去一看发现是杂物间，楼上还传来了流行音乐。</p>

<p>有个和尚在后院池子里放生了几条水蛇，另外一个手持 iPad Air 给他拍照。那个池子整个就是一潭死水啊，里面还有好多死掉了的金鱼。</p>

<p>有个展馆，里面有台触屏的电脑用来运行宣传的程序的。我一下玩出了屏幕键盘，然后就喜闻乐见地打开了资源管理器，翻了下目录没发现啥不和谐的东西。lmh 手贱一下把那个宣传的程序关掉了，于是赶快跑了。</p>

<p>有个宝殿叫做大雄宝殿……脑补了一下好想笑哈哈哈哈哈哈哈。</p>

<p>宝殿里是不准拍照的……虽然很想对着那个“禁止拍照”的牌子来一张但想了想还是没这么干。</p>

<p>有两个宝殿里放了免费的宣传资料……好像是什么佛祖的语录？尼玛用的那种论文的装订比这次集训队的论文集还厚……吓尿了。</p>

<p>有人在池子后面的建筑的二层公然秀恩爱……不能忍。</p>

<p>有一个亭子，我们在亭子里吃中午没吃完的东西……感觉对佛祖不是很尊重，但想了想反正我也不信佛所以就没管了。</p>

<p>有传说中的方丈房，隔着窗户看了一下，感觉和宾馆的房间没太大区别啊？听说这里是文物局干部培训中心。呵呵。</p>

<p>有个绍兴餐馆……绍兴大爷遍布全国各地。</p>

<p>有个素斋餐厅……进寺庙不是要收钱的嘛别人还会为了来这里吃饭专门出门票钱吗？</p>

<p>寺庙门口有一堆卖葫芦的，有一个人面前摆了两框葫芦，和用小袋子装的一对一对的葫芦。前面两框里每个5圆和10来圆，后面那个一对120……P神表示他买了两个10来圆的能不能送一个小袋子用来装葫芦，他120再卖给别人。</p>

<p>门口除了卖葫芦的还有一个超神的写着“预测百事“的摊子，不过没人。还有个预测电话1×552252971，×那里不知道是啥，但反正可能的也没几个数字，有兴趣的读者可以试着打一下预测一下今年的集训队有谁。</p>

<p><br /></p>

<p>大概4点左右准备回去了。走在路上就起风了，一幅要下雨的样子。虽然直到上了公交车都没下雨，但着实被扬尘瞎了狗眼，回来一擦脸上都是灰。公交车司机走了一条非常规的路线，结果不认得路了，还是后排乘客指的路……之后还转了一趟车，好不容易乘地铁回到北大东门了结果尼玛下雨了而我们四人只有一把伞……P神大无畏地披着衣服走，我们三人一起挤在伞下找公交车站……</p>

<p>之后回到了北航，在对面的一个餐馆和学长们和学姐聚餐。聊得还是挺欢乐的。</p>

<p>由于我是明天的高铁票，所以还得在这住一晚。lsp 给我和 lmh 订了一个对门小旅馆的房间，进房间一看……果真是小旅馆。房间里除了卫生间就只有两张床和一个特别小的桌子，剩下可以走路的面积大概只有5平米不到。幸好这里还有 Wi-Fi，不过没有坐的地方……你们绝对想象不到我现在是在以一种什么姿势在写这篇游记。</p>

<p><br /></p>

<p>如果明天能够准点赶上高铁那么这次 CTSC 之行就算是圆满了。（立 flag</p>

<p><br /></p>
<h2 id="52">5.2</h2>

<p>事实证明立 flag 没有那么容易……一路上挺顺利的。</p>

<p>早餐在隔壁肯德基吃的。第一次吃肯德基早餐要怎么做才能装出一副经常吃的样子呢。点了个猪肉蛋堡，拿到手一看尼玛和拍的不一样啊怎么这么小。附带的咖啡竟然是黑咖啡，加了三包糖和三盒奶才能喝。</p>

<p>也没别的槽点了……就这样吧。</p>

<p>至此结束了我 OI 生涯的最后一次比赛。</p>

  </div>

  <footer class="post-footer">
    <div class="post-meta">
       <time datetime="2014-05-01T13:01:00+00:00" itemprop="datePublished">May 1, 2014</time> 
      
    </div>

    
  </footer>

  
  <div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    this.page.url = 'http://zecong.hu/2014/05/01/ctsc2014-travel-notes/';
    this.page.identifier = 'http://zecong.hu/2014/05/01/ctsc2014-travel-notes/';
  };

  (function() {
    var d = document, s = d.createElement('script');

    s.src = 'https://huzecong-blog.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

  
</article>

    </div>
    <script type="text/javascript">
  (function () {
    var resize = function () {
      this.width = 0.5 * (this.naturalWidth || this.width);
    }
    Array.prototype.forEach.call(document.querySelectorAll(".half-size, .retina2x"), function(el) {
      if (el.naturalWidth) {
        resize.call(el);
      } else {
        el.onload = resize;
      }
    });
  })();
</script>

  </main>

  
<script type="text/javascript">
  // Show tooltips for footnotes.
  (function() {
    const footnotes = document.querySelectorAll(".footnotes > ol > li");
    const returnMarkRegex = /("?&nbsp;<a href="#fnref:.+?" class="reversefootnote">↩(<sup>.*?<\/sup>)*<\/a>)+/s;
    const footnoteMarks = document.querySelectorAll("a.footnote");
    for (let index of footnoteMarks.keys()) {
      if (footnotes[index] === undefined) continue;
      const content = footnotes[index].innerHTML.replace(returnMarkRegex, "");
      const footnote = footnoteMarks[index];
      tippy(footnote, {
        content: content,
        arrow: true,
        animation: 'shift-away',
        interactive: true,
        theme: 'light',
        // trigger: 'click',
        size: 'large',
        touch: false,
        touchHold: true,
      });
    }
  })();
</script>



<script type="text/javascript">
  // Add "active" highlight to TOC on left.
  // Credit: https://codemyui.com/sidebar-menu-scroll-progress-indicator/
  (function() {
    const svg_html = ' \
      <svg class="toc-marker" width="200" height="200" \
           xmlns="http://www.w3.org/2000/svg"> \
        <path stroke="#444" stroke-width="1.5" fill="transparent" \
              stroke-dasharray="0, 0, 0, 1000" stroke-linecap="round" \
              stroke-linejoin="round" transform="translate(-0.5, -0.5)" /> \
      </svg> \
      '
    document.querySelector("#table-of-contents .toc-wrapper").innerHTML += svg_html;
  })();

  // Jekyll renders everything on one level, so nested titles are not actuall
  // nested in the DOM. We need to manually create the levels.
  const contentElems = document.querySelector("article > div.post-content").children;
  // A `tocItem` is a dictionary.
  const tocItems = [].slice
    .call(document.querySelectorAll("#table-of-contents li.toc-entry"))
    .map(function(item) {
      const anchor = item.querySelector("a");
      const subList = item.querySelector("ul");
      return {
        item: item,
        href: anchor.getAttribute("href").substr(1),  // remove '#' prefix
        anchor: anchor,
        subList: subList,
      };
    });
  let tocPointer = 0;
  const validTags = ["H1", "H2", "H3", "H4", "H5", "H6"];
  for (let index = 0; index < contentElems.length; ++index) {
    const elem = contentElems[index];
    if (validTags.indexOf(elem.tagName) !== -1) {
      const level = parseInt(elem.tagName[1]);

      if (tocPointer > 0 && tocPointer <= tocItems.length) {
        tocItems[tocPointer - 1].targetBottom = contentElems[index - 1];
      }

      // Current element matches the next entry in the TOC.
      if (tocPointer < tocItems.length &&
          elem.id === tocItems[tocPointer].href) {
        const curTocItem = tocItems[tocPointer];
        curTocItem.level = level;
        curTocItem.titleElem = elem;
        ++tocPointer;
      }
    }
  }
  // Final TOC items has not yet ended.
  if (tocPointer > 0 && tocPointer <= tocItems.length) {
    tocItems[tocPointer - 1].targetBottom = contentElems[contentElems.length - 1];
  }

  let pathLength;

  const tocPath = document.querySelector('.toc-marker path');

  function drawPath() {
    const path = [];
    let pathIndent,
        topOffset = 0;

    // pathLength = 100000;
    // setActivePath(currentActiveIndex);

    tocItems.forEach(function(item) {
      const x = item.anchor.offsetLeft - 5,
            height = item.anchor.offsetHeight;
      const y = topOffset;

      const parent = item.item.parentNode;
      
      if (!(parent.classList.contains("section-nav") ||
            parent.parentNode.classList.contains("expand"))) {
        // Top-level section.
        item.pathStart = 0;
        item.pathEnd = 0;
        return;
      }

      if (path.length === 0) {
        path.push( 'M', x, y, 'L', x, y + height );
        item.pathStart = 0;
      } else {
        // Draw an additional line when there's a change in
        // indent levels.
        if (pathIndent !== x) path.push('L', pathIndent, y);
        path.push('L', x, y);

        // Set the current path so that we can measure it.
        tocPath.setAttribute('d', path.join(' '));
        item.pathStart = tocPath.getTotalLength() || 0;

        path.push('L', x, y + height);
      }
      topOffset += height;

      pathIndent = x;
      tocPath.setAttribute('d', path.join(' '));
      item.pathEnd = tocPath.getTotalLength();
    });

    pathLength = tocPath.getTotalLength();
  }

  let currentActiveIndex = null;

  function setActivePath(index) {
    // Specify the visible path or hide the path altogether
    // if there are no visible items.
    if (index !== null) {
      const pathStart = tocItems[index].pathStart;
      const pathEnd = tocItems[index].pathEnd;
      if (pathEnd === 0) {
        // no-op
      } else {
        tocPath.setAttribute('stroke-dashoffset', '1');
        // Set dash end to an infinitely large value to avoid
        // accidental repetition of pattern.
        tocPath.setAttribute(
          'stroke-dasharray',
          '1, ' + pathStart + ', '+ (pathEnd - pathStart) + ', ' + 10000000);
        tocPath.setAttribute('opacity', 1);
      }
      // console.log(index, tocItems[index].href, pathStart, pathEnd, pathLength);
    } else {
      tocPath.setAttribute('opacity', 0);
    }
  }

  function setActiveEntryClass(index, className) {
    // Set CSS classes for the current index and ancestors.
    const isActive = Array(tocItems.length).fill(false);
    // Compute heights of each item after expanding here, because `scrollHeight`
    // does not take into account inner height of nested non-expanded lists that
    // will also be expanded next.
    const expandedHeights = Array(tocItems.length).fill(0);

    if (index !== null) {
      let item = tocItems[index];
      let curLevel = Infinity;
      let accumulateHeight = 0;
      for (let i = index; i >= 0; --i) {
        item = tocItems[i];
        if (item.level < curLevel) {
          curLevel = item.level;
          if (item.subList !== null)
            accumulateHeight += item.subList.scrollHeight;
          expandedHeights[i] = accumulateHeight;
          isActive[i] = true;
        }
      }
    }

    const itemsToAdd = [], itemsToRemove = [];
    const addHeights = [];
    for (let i = 0; i < tocItems.length; ++i) {
      const item = tocItems[i];
      if (item.item.classList.contains(className)) {
        if (!isActive[i]) {
          item.item.classList.remove(className);
          if (item.subList !== null) {
            itemsToRemove.push(item.subList);
          }
        }
      } else {
        if (isActive[i]) {
          item.item.classList.add(className);
          if (item.subList !== null) {
            itemsToAdd.push(item.subList);
            addHeights.push(expandedHeights[i]);
          }
        }
      }
    }

    return {
      add: itemsToAdd,
      addHeights: addHeights,
      remove: itemsToRemove,
    };
  }

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // Ticket-based queue.
  let transitionTicket = 0, transitionCounter = 0;

  // Credit: https://css-tricks.com/using-css-transitions-auto-dimensions/
  async function toggleItems() {

    // Empty loop waiting for ticket.
    const ticket = transitionCounter++;
    while (ticket !== transitionTicket) {
      await sleep(100);
    }

    // if (ticket + 1 !== transitionCounter) {
    //   transitionTicket = ticket + 1;
    //   return;
    // }

    // Use the latest active index.
    const index = currentActiveIndex;
    itemChanges = setActiveEntryClass(index, "expand");

    if (itemChanges.add.length === 0 && itemChanges.remove.length === 0) {
      // if (ticket + 1 === transitionCounter) {
        // Only perform callback on final ticket.
        // drawPath();
        setActivePath(index);
      // }
      // Null transition, release ticket.
      transitionTicket = ticket + 1;
      return;
    }

    const firstItem = (itemChanges.add.length > 0 ?
                       itemChanges.add[0] : itemChanges.remove[0]);
    const originalTransition = firstItem.style.transition;
    const allItems = itemChanges.add.concat(itemChanges.remove);

    const targetHeight = itemChanges.addHeights;
    allItems.forEach(item => item.style.transition = "");
    for (let item of itemChanges.add) {
      item.style.height = "0";
    }
    for (let item of itemChanges.remove) {
      item.style.height = item.scrollHeight + "px";
    }
    firstItem.offsetHeight;  // trigger reflow

    requestAnimationFrame(function() {
      for (let i = 0; i < itemChanges.add.length; ++i) {
        const item = itemChanges.add[i];
        item.style.height = targetHeight[i] + "px";
      }
      for (let i = 0; i < itemChanges.remove.length; ++i) {
        const item = itemChanges.remove[i];
        item.style.height = "0";
      }
      allItems.forEach(item => item.style.transition = originalTransition);
      firstItem.offsetHeight;  // trigger reflow

      firstItem.addEventListener('transitionend', function(e) {
        // Event listeners are also fired for children nodes.
        if (e.target !== firstItem) return;
        e.target.removeEventListener(e.type, arguments.callee);
        for (let item of itemChanges.add) {
          item.style.height = "auto";
        }
        for (let item of itemChanges.remove) {
          item.style.height = null;
        }
        firstItem.offsetHeight;  // trigger reflow

        // End of transition, release ticket.
        transitionTicket = ticket + 1;
      });

      drawPath();
      setActivePath(index);
    });
  }

  function updateActive(event, forceRedraw = false) {
    const windowHeight = window.innerHeight;

    // We only allow one entry to be active. This entry must satisfy one of the
    // following conditions:
    // 1. Its section is the only section visible on screen.
    // 2. Its title (`targetTop`) is the first title that is within screen bounds.
    const titlePos = tocItems.map(function(item) {
      return item.titleElem.getBoundingClientRect();
    });
    const targetBottom = tocItems.map(function(item) {
      return item.targetBottom.getBoundingClientRect().bottom;
    });

    let index = 0;
    for (; index < tocItems.length; ++index) {
      if (// Any portion of title is within screen bounds.
          (0 < titlePos[index].bottom && titlePos[index].top < windowHeight) ||
          // Section is the only one on screen...
          (titlePos[index].top < 0 &&
            // ... and is the final section.
           ((index === tocItems.length - 1 &&
             targetBottom[index] > 0) ||
            // ... and the next section title is not completely shown.
            (index < tocItems.length - 1 &&
             titlePos[index + 1].bottom > windowHeight)))) {
        break;
      }
    }
    if (index >= tocItems.length) index = null;

    if (currentActiveIndex !== index || forceRedraw) {
      // console.log("redraw", currentActiveIndex, index, forceRedraw);
      currentActiveIndex = index;

      // setActivePath(index);
      setActiveEntryClass(index, "active");

      requestAnimationFrame(function() {
        toggleItems();
      });
    }
  }

  drawPath();
  updateActive(true);
  window.addEventListener('resize', function(event) {
    updateActive(event, true);
  }, false);
  window.addEventListener('scroll', updateActive, false);
</script>


<footer class="site-footer">

  <div class="wrapper">
    <div class="social-links">
      
      <a class="social-link social-github" href="https://github.com/huzecong">
        <i class="icon-github"></i>
      </a>
      
      
      
      <a class="social-link social-rss" href="/feed.xml" target="_blank">
        <i class="icon-rss"></i>
      </a>
    </div>
    <div class="credits">
      KAGAMI, made with <i class="icon-heart"></i> by Kamikat
    </div>
  </div>

</footer>


</body>

</html>

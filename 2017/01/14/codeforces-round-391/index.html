<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Codeforces Round #391 - Zecong Hu&#39;s blog</title>
  <meta name="description" content="è½¬çœ¼ä¹‹é—´å·²ç»åˆ°äº†å¤§ä¸‰ï¼Œè·é€€å½¹å·²ç»ä¸‰å¹´äº†ã€‚è€ƒå®ŒæœŸæœ«è€ƒè¯•ï¼Œæ­£å¥½æœ‰ä¸€åœº CFï¼ŒæŠ±ç€åšåº·å¤è®­ç»ƒçš„å¿ƒæ€å‚åŠ äº†æ¯”èµ›ã€‚ ç»“æœè‡ªç„¶æ˜¯æƒ¨ä¸å¿ç¹â€¦â€¦è™½ç„¶æ˜¯å’ŒåŒå­¦å¼€é»‘ï¼Œå´ä¹Ÿæ— æµäºäº‹ã€‚å†™äº†5é“é¢˜ï¼Œæœ€ååªè¿‡äº†ä¸¤é“ã€‚å¤§æ¦‚å·²ç»ä¸é€‚åˆå¿«èŠ‚å¥åœ°å†™ä»£ç äº†å§ã€‚ ä½†ä¸ç®¡æ€ä¹ˆè¯´ï¼Œè¿™æ¬¡çš„é¢˜ç›®è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ã€‚è€Œä¸”æˆ‘ä»¬çš„åšæ³•å’Œå®˜æ–¹åšæ³•æœ‰äº›å·®åˆ«ï¼Œè‡ªè®¤ä¸ºä¹Ÿæ˜¯å¾ˆæœ‰æ„...">

  
  <link rel="stylesheet" href="/assets/styles/core.css?v=20191121014911">
  <link rel="stylesheet" href="/assets/styles/fontello.css?v=20191121014911">
  <link rel="stylesheet" href="/assets/styles/highlighting/default.css?v=20191121014911">

  <link rel="canonical" href="http://zecong.hu/2017/01/14/codeforces-round-391/">
  <link rel="alternate" type="application/rss+xml" title="Zecong Hu&#39;s blog" href="/feed.xml">

  <link rel="apple-touch-icon" sizes="57x57" href="/assets/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicon/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://unpkg.com/tippy.js@4/themes/light.css">
  <script src="https://unpkg.com/popper.js@1/dist/umd/popper.min.js"></script>
  <script src="https://unpkg.com/tippy.js@4/umd/index.all.min.js"></script>
  

  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      TeX: {
        equationNumbers: {
          autoNumber: "AMS"
        }
      },
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(', '\\)'] ],
        displayMath: [ ['$$','$$'] ],
        processEscapes: true,
      }
    });
  </script>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  

  
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48327586-2', 'auto');
  ga('send', 'pageview');

</script>
  

  
</head>

  <body>

  <main class="page-content" aria-label="Content">
    
    <div id="table-of-contents">
      <div class="toc-wrapper">
        <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#a">A</a></li>
<li class="toc-entry toc-h2"><a href="#b">B</a></li>
<li class="toc-entry toc-h2"><a href="#c">C</a></li>
<li class="toc-entry toc-h2"><a href="#d">D</a></li>
<li class="toc-entry toc-h2"><a href="#e">E</a></li>
</ul>
      </div>
    </div>
    

    <div class="wrapper">
      <nav class="site-nav">
  
  
  	
  	<a class="page-link" href="/" >About</a>
  	
  
  	
  	<a class="page-link" href="/index/en/index.html" >Articles</a>
  	
  
  	
  	<a class="page-link" href="/index/cn/index.html" >æ–‡ç« åˆ—è¡¨</a>
  	
  
  	
  
  	
  
</nav>



<article class="post" lang="zh-Hans" itemscope itemtype="http://schema.org/BlogPosting" >

  <header class="post-header">
  <a class="site-title" href="/">
  	
      Zecong Hu&#39;s blog
    
  </a>
  <h1 class="post-title" itemprop="name headline">Codeforces Round #391</h1>
</header>




  <div class="post-content" itemprop="articleBody">
    <p>è½¬çœ¼ä¹‹é—´å·²ç»åˆ°äº†å¤§ä¸‰ï¼Œè·é€€å½¹å·²ç»ä¸‰å¹´äº†ã€‚è€ƒå®ŒæœŸæœ«è€ƒè¯•ï¼Œæ­£å¥½æœ‰ä¸€åœº CFï¼ŒæŠ±ç€åšåº·å¤è®­ç»ƒçš„å¿ƒæ€å‚åŠ äº†æ¯”èµ›ã€‚</p>

<p>ç»“æœè‡ªç„¶æ˜¯æƒ¨ä¸å¿ç¹â€¦â€¦è™½ç„¶æ˜¯å’ŒåŒå­¦å¼€é»‘ï¼Œå´ä¹Ÿæ— æµäºäº‹ã€‚å†™äº†5é“é¢˜ï¼Œæœ€ååªè¿‡äº†ä¸¤é“ã€‚å¤§æ¦‚å·²ç»ä¸é€‚åˆå¿«èŠ‚å¥åœ°å†™ä»£ç äº†å§ã€‚</p>

<p>ä½†ä¸ç®¡æ€ä¹ˆè¯´ï¼Œè¿™æ¬¡çš„é¢˜ç›®è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ã€‚è€Œä¸”æˆ‘ä»¬çš„åšæ³•å’Œå®˜æ–¹åšæ³•æœ‰äº›å·®åˆ«ï¼Œè‡ªè®¤ä¸ºä¹Ÿæ˜¯å¾ˆæœ‰æ„æ€çš„æ€è·¯ã€‚</p>

<!--more-->

<h2 id="a">A</h2>

<p>æ²¡å•¥å¥½è¯´çš„ã€‚æŠŠè®¡æ•°çš„æ•°ç»„å¼€æˆäº† <code class="highlighter-rouge">char</code>ï¼Œè´¡çŒ®äº†ä¸€æ¬¡ WAã€‚</p>

<h2 id="b">B</h2>

<p>ç»å…¸é¢˜ã€‚ä»¥å„ç§ä¸åŒçš„æ–¹å¼çŠ¯å‚»ï¼Œä¸€å…±é”™äº†3æ¬¡ã€‚</p>

<h2 id="c">C</h2>

<p>å¤§æ„æ˜¯ï¼Œé—®æœ‰å¤šå°‘ä¸ªåŒå°„ $f$ ï¼Œæ»¡è¶³å¯¹äºæ¯ä¸ªå¤šé‡é›† $S_i$ ï¼Œ $S_i=f(S_i)$ ã€‚</p>

<p>å…¶å®å°±æ˜¯å¯¹äºä¸€ç§å…ƒç´  $x$ ï¼Œåœ¨æ¯ä¸ªå¤šé‡é›†ä¸­ï¼Œå…¶å‡ºç°æ¬¡æ•°åº”å½“ç­‰äº $f(x)$ çš„å‡ºç°æ¬¡æ•°ã€‚å¯ä»¥ä¾æ¬¡æŠŠå…ƒç´ åˆ’åˆ†æˆè‹¥å¹²ç­‰ä»·ç±»ï¼Œç­”æ¡ˆå³ç­‰ä»·ç±»å¤§å°çš„é˜¶ä¹˜çš„ä¹˜ç§¯ã€‚</p>

<p>é—®é¢˜åœ¨äºå¦‚ä½•æ±‚å‡ºç­‰ä»·ç±»ã€‚æˆ‘ä»¬æ€è€ƒäº†å„ç§æ–¹æ³•ï¼Œæœ€åçŒœæµ‹ï¼Œè¯´ä¸å®šæ˜¯ä¸€ä¸ªçœ‹ä¸Šå»å¾ˆæš´åŠ›ï¼Œä½†å…¶å®å¤æ‚åº¦å¯ä»¥æ¥å—çš„æ–¹æ³•ã€‚äºæ˜¯å°±æœ‰äº†ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼š</p>

<p>ç”¨ä¸€ä¸ª <code class="highlighter-rouge">vector&lt;pair&lt;int, int&gt;&gt;</code> æè¿°å…ƒç´  $x$ ï¼šæ¯ä¸ªäºŒå…ƒç»„ $(i,k)$ ä»£è¡¨ $S_i$ ä¸­ $x$ å‡ºç°äº† $k$ æ¬¡ï¼Œå¦‚æœ $k=0$ é‚£ä¹ˆä¸æŠŠè¿™ä¸ªäºŒå…ƒç»„åŠ å…¥ vectorã€‚è¿™æ ·ä¸€æ¥æ‰€æœ‰å…ƒç´ çš„ vector é•¿åº¦ä¹‹å’Œæ˜¯ $O(\sum{g_i})$ çš„ã€‚ä¹‹åè¦åšçš„å°±æ˜¯ç»Ÿè®¡æœ‰å¤šå°‘ä¸åŒçš„ vector äº†ã€‚æœ€ç›´è§‚çš„æ–¹æ³•æ˜¯æ’åºä¹‹åæ‰«æï¼Œå®é™…ä¸Šç›´æ¥å¯¹è¿™äº› vector è¿›è¡Œæ’åºå¤æ‚åº¦ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ï¼Œä½†è€ƒåœºä¸Šæ²¡æœ‰æƒ³æ˜ç™½ï¼Œå°±ç”¨äº†å“ˆå¸Œçš„æ–¹æ³•ã€‚æœ‰æ„æ€çš„æ˜¯ï¼Œç¬¬ä¸€æ¬¡æäº¤åªä½¿ç”¨äº†å•å…³é”®å­—ï¼Œä¹‹åæƒ¨é­ Hackâ€¦â€¦è¢«è¿«æ”¹æˆäº†åŒå…³é”®å­—ã€‚</p>

<p>ç„¶è€Œæœ€åæ•°ç»„å¼€å°äº† RE äº†â€¦â€¦</p>

<p>æœ€åè¯æ˜ä¸€ä¸‹æ’åºçš„å¤æ‚åº¦ï¼Œå…¶å®æ˜¯ $O(n\log n\cdot d)$ ï¼Œå…¶ä¸­ $d$ ä¸º vector çš„æœŸæœ›é•¿åº¦ã€‚è¿™ä¸ªé•¿åº¦å…¶å®æ˜¯ $O(\sum g_i/n)$ ï¼Œæ‰€ä»¥å¤æ‚åº¦å°±æ˜¯ $O\left((\sum g_i)\log n\right)$ ã€‚</p>

<h2 id="d">D</h2>

<p>æœ€ååªå‰©15åˆ†é’Ÿçš„æ—¶å€™æ‰å¼€å§‹æƒ³è¿™é¢˜ï¼Œè¿˜æ˜¯æ²¡èƒ½åœ¨æ¯”èµ›ç»“æŸå‰é€šè¿‡ã€‚</p>

<p>å…¶å®å¾ˆç®€å•ï¼Œå› ä¸º $n\leq 75$ ï¼Œç®—ä¸€ç®—å°±çŸ¥é“åˆæ³•åˆ†å‰²é‡Œæœ€å¤§çš„æ•°ä¸è¶…è¿‡20ã€‚å› æ­¤å¯ä»¥ç›´æ¥çŠ¶å‹ DPï¼ŒçŠ¶æ€ $f[i][S]$ è¡¨ç¤ºå‰ $i$ ä¸ª01ï¼Œå‡ºç°æ•°å­—é›†åˆä¸º $S$ æ—¶çš„æ–¹æ¡ˆæ•°ï¼ŒçŠ¶æ€ç©ºé—´ $O(n\cdot2^{20})$ ã€‚è€Œè‡³äºè½¬ç§»ï¼Œä¸¤ä¸ªåˆ‡å‰²ç‚¹ä¹‹é—´çš„éƒ¨åˆ†ï¼Œé™¤å»å‰å¯¼é›¶ä¹‹åé•¿åº¦å¿…ç„¶ä¸è¶…è¿‡6ï¼Œè€Œå…¨éƒ¨ä¸º0æ—¶ä¸è½¬ç§»ï¼›æ•…è½¬ç§»æ˜¯ $O(1)$ çš„ã€‚</p>

<h2 id="e">E</h2>

<p>è¿™é¢˜éå¸¸æœ‰æ„æ€ã€‚</p>

<p>å®šä¹‰ $f_r(n)$ å¦‚ä¸‹ï¼š</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
f_0(n) & = \sum_{u\cdot v=n}\left[\gcd(u,v)=1\right] \\
f_{r+1}(n) & = \sum_{u\cdot v=n}\frac{f_r(u)+f_r(v)}{2}
\end{align*} %]]></script>

<p>æœ‰ $q$ ä¸ªè¯¢é—®ï¼Œæ¯æ¬¡ç»™å®š $r$ å’Œ $n$ ï¼Œæ±‚ $f_r(n)$ ã€‚æ‰€æœ‰èŒƒå›´å‡ä¸º $10^6$ ã€‚</p>

<p>å¯ä»¥å‘ç°ï¼Œè®° $k$ ä¸º $n$ çš„è´¨å› å­ä¸ªæ•°ï¼Œé‚£ä¹ˆ $f_0(n)=2^k$ ã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸ªè´¨å› å­è¦ä¹ˆå…¨éƒ¨å±äº $u$ ï¼Œè¦ä¹ˆå…¨éƒ¨å±äº $v$ ã€‚</p>

<p>è€Œ $f_{r+1}$ çš„å¼å­å¯ä»¥æ”¹å†™å¦‚ä¸‹ï¼š</p>

<script type="math/tex; mode=display">f_{r+1}(n) = \sum_{d\mid n}f_r(d) = \sum_{d\mid n}f_r(d)\cdot 1</script>

<p>è®° $1(n)$ ä¸ºå¸¸æ•°å‡½æ•° $1(n)=1$ ï¼Œé‚£ä¹ˆå¯ä»¥å°†ä¸Šå¼è¡¨ç¤ºä¸º Dirichlet å·ç§¯çš„å½¢å¼ï¼š</p>

<script type="math/tex; mode=display">f_{r+1}=f_r\ast 1=f_0*1^r</script>

<p>å’Œä¸€èˆ¬å·ç§¯ä¸€æ ·ï¼ŒDirichlet å·ç§¯ä¹Ÿæ»¡è¶³ç»“åˆå¾‹ã€‚å› æ­¤æˆ‘ä»¬ç ”ç©¶ $1^r$ çš„è¡¨è¾¾å¼ã€‚</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
1^2(n) & = (1 \ast 1)(n) \\
 & = \sum_{d\mid n}1\cdot 1 \\
1^3(n) & = (1^2 \ast 1)(n) \\
 & = \sum_{d_2\mid n}\left(\sum_{d_1\mid d_2}1\cdot 1\right)\cdot 1 \\
 & \cdots \\
1^r(n) & = \sum_{d_1\mid d_2\mid \cdots\mid d_{r-1}\mid n}1
\end{align*} %]]></script>

<p>æ¢å¥è¯è¯´ï¼Œå³æ±‚é•¿åº¦ä¸º $r-1$ çš„åºåˆ— $d_1,\ldots,d_{r-1}$ çš„æ–¹æ¡ˆæ•°ï¼Œå…¶ä¸­åºåˆ—æ»¡è¶³ $d_i\mid d_{i+1}$ ï¼Œ $d_{r-1}\mid n$ ã€‚</p>

<p>è®° $n$ çš„è´¨å› æ•°åˆ†è§£ä¸º $n=\prod p_i^{k_i}$ ï¼Œä»…è€ƒè™‘ä¸€ä¸ªè´¨å› å­ $p_i$ ï¼Œé‚£ä¹ˆ $d_1,\ldots,d_{r-1}$ çš„æ¯ä¸ªæ•°æ‰€åŒ…å«çš„ $p_i$ çš„æ¬¡æ•°éƒ½ä¸åº”å¤§äº $k_i$ ï¼Œä¸”å‰ä¸€ä¸ªæ•°çš„æ¬¡æ•°ä¸åº”å¤§äºåä¸€ä¸ªæ•°çš„æ¬¡æ•°ã€‚é—®é¢˜å°±å˜æˆäº†ï¼šæ±‚é•¿åº¦ä¸º $r-1$ ä¸”æœ€å¤§æ•°ä¸è¶…è¿‡ $k_i$ çš„éè´Ÿéé™åºåˆ—çš„æ–¹æ¡ˆæ•°ã€‚ç”¨éš”æ¿æ³•å¯ä»¥çŸ¥é“æ–¹æ¡ˆæ•°ä¸º</p>

<script type="math/tex; mode=display">\binom{k_i+r-1}{r-1}</script>

<p>é‚£ä¹ˆ</p>

<script type="math/tex; mode=display">1^r(n)=\prod_i \binom{k_i+r-1}{r-1}</script>

<script type="math/tex; mode=display">f_{r}(n) = (f_0 \ast 1^{r-1})(n) = \sum_{d\mid n}f_0(d)\cdot 1^{r-1}\left(\frac{n}{d}\right)</script>

<p>è‡³æ­¤ï¼Œåªè¦ç”¨ç­›æ³•é¢„å¤„ç†å‡ºæœ€å°è´¨å› å­ï¼Œå³å¯åœ¨ $O(\tau(n))$ ï¼ˆå› å­æ•°ï¼‰çš„æ—¶é—´å†…å›ç­”ä¸€ä¸ªè¯¢é—®ã€‚ä½†è¿™è¿˜ä¸å¤Ÿå¿«ï¼ˆæ¯”èµ›æ—¶äº¤çš„è¿™ä¸ªåšæ³•ï¼ŒTLE åœ¨äº† Final Test çš„ç¬¬52ä¸ªç‚¹â€¦â€¦ï¼‰ã€‚</p>

<p>ç”±äº $d$ å’Œ $\frac{n}{d}$ éƒ½æ˜¯ $n$ çš„å› å­ï¼Œè®° $d$ çš„è´¨å› æ•°åˆ†è§£ä¸º $d=\prod{p_i^{q_i}}$ ï¼Œé‚£ä¹ˆ $q_i\leq k_i$ ï¼Œè€Œä¸” $\frac{n}{d}=\prod{p_i^{k_i-q_i}}$ ã€‚è¿›è€Œæˆ‘ä»¬å¯ä»¥å°† $f_0(d)$ è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>

<script type="math/tex; mode=display">f_0(d) = \prod_i (1+[q_i>0])</script>

<p>å¸¦å…¥ $f_r$ çš„å¼å­å¾—åˆ°</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
f_r(n) & = \sum_{d\mid n}\left(\prod_i (1+[q_i>0])\right)\left(\prod_i \binom{k_i-q_i+r-1}{r-1}\right) \\
 & = \sum_{d\mid n}\prod_i (1+[q_i>0])\binom{k_i-q_i+r-1}{r-1} \\
 & = \prod_i\sum_{q_i=0}^{k_i} (1+[q_i>0])\binom{k_i-q_i+r-1}{r-1}
\end{align*} %]]></script>

<p>å› æ­¤åªè¦å¯¹æ¯ä¸ªè´¨å› å­å•ç‹¬è®¡ç®—å°±å¯ä»¥äº†ã€‚å¤æ‚åº¦éª¤é™ä¸º $O(\log n)$ ã€‚</p>

<p>å‘ç°äº†ä»€ä¹ˆå—=Â·=è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªç§¯æ€§å‡½æ•°â€¦â€¦å¦‚æœä¸€å¼€å§‹å°±æ„è¯†åˆ°è¿™ä¸€ç‚¹çš„è¯ï¼Œæ•´ä¸ªæ¨å¯¼å…¶å®éå¸¸ç®€å•ï¼Œæ ¹æœ¬ä¸éœ€è¦è€ƒè™‘ä»€ä¹ˆ Dirichlet å·ç§¯çš„ç»“åˆæ€§â€¦â€¦</p>

<p>è™½ç„¶ç»•äº†å¾ˆå¤§çš„å¼¯è·¯ï¼Œä½†è¿™ä¸ªæ€è·¯è¿˜æ˜¯æŒºæœ‰è¶£çš„ğŸ˜‚</p>

  </div>

  <footer class="post-footer">
    <div class="post-meta">
       <time datetime="2017-01-14T05:43:00+00:00" itemprop="datePublished">Jan 14, 2017</time> 
      
    </div>

    
  </footer>

  
  <div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    this.page.url = 'http://zecong.hu/2017/01/14/codeforces-round-391/';
    this.page.identifier = 'http://zecong.hu/2017/01/14/codeforces-round-391/';
  };

  (function() {
    var d = document, s = d.createElement('script');

    s.src = 'https://huzecong-blog.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

  
</article>

    </div>
    <script type="text/javascript">
  (function () {
    var resize = function () {
      this.width = 0.5 * (this.naturalWidth || this.width);
    }
    Array.prototype.forEach.call(document.querySelectorAll(".half-size, .retina2x"), function(el) {
      if (el.naturalWidth) {
        resize.call(el);
      } else {
        el.onload = resize;
      }
    });
  })();
</script>

  </main>

  
<script type="text/javascript">
  // Show tooltips for footnotes.
  (function() {
    const footnotes = document.querySelectorAll(".footnotes > ol > li");
    const returnMarkRegex = /("?&nbsp;<a href="#fnref:.+?" class="reversefootnote">â†©(<sup>.*?<\/sup>)*<\/a>)+/s;
    const footnoteMarks = document.querySelectorAll("a.footnote");
    for (let index of footnoteMarks.keys()) {
      if (footnotes[index] === undefined) continue;
      const content = footnotes[index].innerHTML.replace(returnMarkRegex, "");
      const footnote = footnoteMarks[index];
      tippy(footnote, {
        content: content,
        arrow: true,
        animation: 'shift-away',
        interactive: true,
        theme: 'light',
        // trigger: 'click',
        size: 'large',
        touch: false,
        touchHold: true,
      });
    }
  })();
</script>



<script type="text/javascript">
  // Add "active" highlight to TOC on left.
  // Credit: https://codemyui.com/sidebar-menu-scroll-progress-indicator/
  (function() {
    const svg_html = ' \
      <svg class="toc-marker" width="200" height="200" \
           xmlns="http://www.w3.org/2000/svg"> \
        <path stroke="#444" stroke-width="1.5" fill="transparent" \
              stroke-dasharray="0, 0, 0, 1000" stroke-linecap="round" \
              stroke-linejoin="round" transform="translate(-0.5, -0.5)" /> \
      </svg> \
      '
    document.querySelector("#table-of-contents .toc-wrapper").innerHTML += svg_html;
  })();

  // Jekyll renders everything on one level, so nested titles are not actuall
  // nested in the DOM. We need to manually create the levels.
  const contentElems = document.querySelector("article > div.post-content").children;
  // A `tocItem` is a dictionary.
  const tocItems = [].slice
    .call(document.querySelectorAll("#table-of-contents li.toc-entry"))
    .map(function(item) {
      const anchor = item.querySelector("a");
      const subList = item.querySelector("ul");
      return {
        item: item,
        href: anchor.getAttribute("href").substr(1),  // remove '#' prefix
        anchor: anchor,
        subList: subList,
      };
    });
  let tocPointer = 0;
  const validTags = ["H1", "H2", "H3", "H4", "H5", "H6"];
  for (let index = 0; index < contentElems.length; ++index) {
    const elem = contentElems[index];
    if (validTags.indexOf(elem.tagName) !== -1) {
      const level = parseInt(elem.tagName[1]);

      if (tocPointer > 0 && tocPointer <= tocItems.length) {
        tocItems[tocPointer - 1].targetBottom = contentElems[index - 1];
      }

      // Current element matches the next entry in the TOC.
      if (tocPointer < tocItems.length &&
          elem.id === tocItems[tocPointer].href) {
        const curTocItem = tocItems[tocPointer];
        curTocItem.level = level;
        curTocItem.titleElem = elem;
        ++tocPointer;
      }
    }
  }
  // Final TOC items has not yet ended.
  if (tocPointer > 0 && tocPointer <= tocItems.length) {
    tocItems[tocPointer - 1].targetBottom = contentElems[contentElems.length - 1];
  }

  let pathLength;

  const tocPath = document.querySelector('.toc-marker path');

  function drawPath() {
    const path = [];
    let pathIndent,
        topOffset = 0;

    // pathLength = 100000;
    // setActivePath(currentActiveIndex);

    tocItems.forEach(function(item) {
      const x = item.anchor.offsetLeft - 5,
            height = item.anchor.offsetHeight;
      const y = topOffset;

      const parent = item.item.parentNode;
      
      if (!(parent.classList.contains("section-nav") ||
            parent.parentNode.classList.contains("expand"))) {
        // Top-level section.
        item.pathStart = 0;
        item.pathEnd = 0;
        return;
      }

      if (path.length === 0) {
        path.push( 'M', x, y, 'L', x, y + height );
        item.pathStart = 0;
      } else {
        // Draw an additional line when there's a change in
        // indent levels.
        if (pathIndent !== x) path.push('L', pathIndent, y);
        path.push('L', x, y);

        // Set the current path so that we can measure it.
        tocPath.setAttribute('d', path.join(' '));
        item.pathStart = tocPath.getTotalLength() || 0;

        path.push('L', x, y + height);
      }
      topOffset += height;

      pathIndent = x;
      tocPath.setAttribute('d', path.join(' '));
      item.pathEnd = tocPath.getTotalLength();
    });

    pathLength = tocPath.getTotalLength();
  }

  let currentActiveIndex = null;

  function setActivePath(index) {
    // Specify the visible path or hide the path altogether
    // if there are no visible items.
    if (index !== null) {
      const pathStart = tocItems[index].pathStart;
      const pathEnd = tocItems[index].pathEnd;
      if (pathEnd === 0) {
        // no-op
      } else {
        tocPath.setAttribute('stroke-dashoffset', '1');
        // Set dash end to an infinitely large value to avoid
        // accidental repetition of pattern.
        tocPath.setAttribute(
          'stroke-dasharray',
          '1, ' + pathStart + ', '+ (pathEnd - pathStart) + ', ' + 10000000);
        tocPath.setAttribute('opacity', 1);
      }
      // console.log(index, tocItems[index].href, pathStart, pathEnd, pathLength);
    } else {
      tocPath.setAttribute('opacity', 0);
    }
  }

  function setActiveEntryClass(index, className) {
    // Set CSS classes for the current index and ancestors.
    const isActive = Array(tocItems.length).fill(false);
    // Compute heights of each item after expanding here, because `scrollHeight`
    // does not take into account inner height of nested non-expanded lists that
    // will also be expanded next.
    const expandedHeights = Array(tocItems.length).fill(0);

    if (index !== null) {
      let item = tocItems[index];
      let curLevel = Infinity;
      let accumulateHeight = 0;
      for (let i = index; i >= 0; --i) {
        item = tocItems[i];
        if (item.level < curLevel) {
          curLevel = item.level;
          if (item.subList !== null)
            accumulateHeight += item.subList.scrollHeight;
          expandedHeights[i] = accumulateHeight;
          isActive[i] = true;
        }
      }
    }

    const itemsToAdd = [], itemsToRemove = [];
    const addHeights = [];
    for (let i = 0; i < tocItems.length; ++i) {
      const item = tocItems[i];
      if (item.item.classList.contains(className)) {
        if (!isActive[i]) {
          item.item.classList.remove(className);
          if (item.subList !== null) {
            itemsToRemove.push(item.subList);
          }
        }
      } else {
        if (isActive[i]) {
          item.item.classList.add(className);
          if (item.subList !== null) {
            itemsToAdd.push(item.subList);
            addHeights.push(expandedHeights[i]);
          }
        }
      }
    }

    return {
      add: itemsToAdd,
      addHeights: addHeights,
      remove: itemsToRemove,
    };
  }

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // Ticket-based queue.
  let transitionTicket = 0, transitionCounter = 0;

  // Credit: https://css-tricks.com/using-css-transitions-auto-dimensions/
  async function toggleItems() {

    // Empty loop waiting for ticket.
    const ticket = transitionCounter++;
    while (ticket !== transitionTicket) {
      await sleep(100);
    }

    // if (ticket + 1 !== transitionCounter) {
    //   transitionTicket = ticket + 1;
    //   return;
    // }

    // Use the latest active index.
    const index = currentActiveIndex;
    itemChanges = setActiveEntryClass(index, "expand");

    if (itemChanges.add.length === 0 && itemChanges.remove.length === 0) {
      // if (ticket + 1 === transitionCounter) {
        // Only perform callback on final ticket.
        // drawPath();
        setActivePath(index);
      // }
      // Null transition, release ticket.
      transitionTicket = ticket + 1;
      return;
    }

    const firstItem = (itemChanges.add.length > 0 ?
                       itemChanges.add[0] : itemChanges.remove[0]);
    const originalTransition = firstItem.style.transition;
    const allItems = itemChanges.add.concat(itemChanges.remove);

    const targetHeight = itemChanges.addHeights;
    allItems.forEach(item => item.style.transition = "");
    for (let item of itemChanges.add) {
      item.style.height = "0";
    }
    for (let item of itemChanges.remove) {
      item.style.height = item.scrollHeight + "px";
    }
    firstItem.offsetHeight;  // trigger reflow

    requestAnimationFrame(function() {
      for (let i = 0; i < itemChanges.add.length; ++i) {
        const item = itemChanges.add[i];
        item.style.height = targetHeight[i] + "px";
      }
      for (let i = 0; i < itemChanges.remove.length; ++i) {
        const item = itemChanges.remove[i];
        item.style.height = "0";
      }
      allItems.forEach(item => item.style.transition = originalTransition);
      firstItem.offsetHeight;  // trigger reflow

      firstItem.addEventListener('transitionend', function(e) {
        // Event listeners are also fired for children nodes.
        if (e.target !== firstItem) return;
        e.target.removeEventListener(e.type, arguments.callee);
        for (let item of itemChanges.add) {
          item.style.height = "auto";
        }
        for (let item of itemChanges.remove) {
          item.style.height = null;
        }
        firstItem.offsetHeight;  // trigger reflow

        // End of transition, release ticket.
        transitionTicket = ticket + 1;
      });

      drawPath();
      setActivePath(index);
    });
  }

  function updateActive(event, forceRedraw = false) {
    const windowHeight = window.innerHeight;

    // We only allow one entry to be active. This entry must satisfy one of the
    // following conditions:
    // 1. Its section is the only section visible on screen.
    // 2. Its title (`targetTop`) is the first title that is within screen bounds.
    const titlePos = tocItems.map(function(item) {
      return item.titleElem.getBoundingClientRect();
    });
    const targetBottom = tocItems.map(function(item) {
      return item.targetBottom.getBoundingClientRect().bottom;
    });

    let index = 0;
    for (; index < tocItems.length; ++index) {
      if (// Any portion of title is within screen bounds.
          (0 < titlePos[index].bottom && titlePos[index].top < windowHeight) ||
          // Section is the only one on screen...
          (titlePos[index].top < 0 &&
            // ... and is the final section.
           ((index === tocItems.length - 1 &&
             targetBottom[index] > 0) ||
            // ... and the next section title is not completely shown.
            (index < tocItems.length - 1 &&
             titlePos[index + 1].bottom > windowHeight)))) {
        break;
      }
    }
    if (index >= tocItems.length) index = null;

    if (currentActiveIndex !== index || forceRedraw) {
      // console.log("redraw", currentActiveIndex, index, forceRedraw);
      currentActiveIndex = index;

      // setActivePath(index);
      setActiveEntryClass(index, "active");

      requestAnimationFrame(function() {
        toggleItems();
      });
    }
  }

  drawPath();
  updateActive(true);
  window.addEventListener('resize', function(event) {
    updateActive(event, true);
  }, false);
  window.addEventListener('scroll', updateActive, false);
</script>


<footer class="site-footer">

  <div class="wrapper">
    <div class="social-links">
      
      <a class="social-link social-github" href="https://github.com/huzecong">
        <i class="icon-github"></i>
      </a>
      
      
      
      <a class="social-link social-rss" href="/feed.xml" target="_blank">
        <i class="icon-rss"></i>
      </a>
    </div>
    <div class="credits">
      KAGAMI, made with <i class="icon-heart"></i> by Kamikat
    </div>
  </div>

</footer>


</body>

</html>

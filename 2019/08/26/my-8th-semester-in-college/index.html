<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>大四下总结 - Zecong Hu&#39;s blog</title>
  <meta name="description" content="系列八篇中的最后一篇。本应在暑假就写完的，结果断断续续拖了整整一年，到现在五字班都毕业了。 请允许我先用几个词概括我的大四下： 忙碌。在我的想象中，毕设不过就是几个大作业的分量，大四下应该比较轻松才对。实际的体验却并非如此。 淡出。四年来习以为常在身边的同学们，并不是像文学作品中那样，在毕业典礼之后有说有笑相互道...">

  
  <link rel="stylesheet" href="/assets/styles/core.css?v=20191121014911">
  <link rel="stylesheet" href="/assets/styles/fontello.css?v=20191121014911">
  <link rel="stylesheet" href="/assets/styles/highlighting/default.css?v=20191121014911">

  <link rel="canonical" href="http://zecong.hu/2019/08/26/my-8th-semester-in-college/">
  <link rel="alternate" type="application/rss+xml" title="Zecong Hu&#39;s blog" href="/feed.xml">

  <link rel="apple-touch-icon" sizes="57x57" href="/assets/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicon/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://unpkg.com/tippy.js@4/themes/light.css">
  <script src="https://unpkg.com/popper.js@1/dist/umd/popper.min.js"></script>
  <script src="https://unpkg.com/tippy.js@4/umd/index.all.min.js"></script>
  

  

  
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48327586-2', 'auto');
  ga('send', 'pageview');

</script>
  

  
</head>

  <body>

  <main class="page-content" aria-label="Content">
    
    <div id="table-of-contents">
      <div class="toc-wrapper">
        <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#毕设">毕设</a>
<ul>
<li class="toc-entry toc-h3"><a href="#开题">开题</a></li>
<li class="toc-entry toc-h3"><a href="#寒假">寒假</a></li>
<li class="toc-entry toc-h3"><a href="#中期答辩">中期答辩</a></li>
<li class="toc-entry toc-h3"><a href="#下半学期">下半学期</a></li>
<li class="toc-entry toc-h3"><a href="#论文撰写">论文撰写</a></li>
<li class="toc-entry toc-h3"><a href="#最终答辩">最终答辩</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#生活">生活</a>
<ul>
<li class="toc-entry toc-h3"><a href="#寝室">寝室</a></li>
<li class="toc-entry toc-h3"><a href="#日常">日常</a></li>
<li class="toc-entry toc-h3"><a href="#学习">学习</a>
<ul>
<li class="toc-entry toc-h4"><a href="#操作系统">操作系统</a></li>
<li class="toc-entry toc-h4"><a href="#系统结构">系统结构</a></li>
<li class="toc-entry toc-h4"><a href="#oop助教">OOP助教</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#女生节">女生节</a></li>
<li class="toc-entry toc-h3"><a href="#马拉松">马拉松</a></li>
<li class="toc-entry toc-h3"><a href="#毕业旅行">毕业旅行</a></li>
<li class="toc-entry toc-h3"><a href="#毕联">毕联</a>
<ul>
<li class="toc-entry toc-h4"><a href="#毕联筹备">毕联筹备</a></li>
<li class="toc-entry toc-h4"><a href="#毕联游戏">毕联游戏</a></li>
<li class="toc-entry toc-h4"><a href="#毕联晚会">毕联晚会</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#旅途的终点">旅途的终点</a></li>
<li class="toc-entry toc-h2"><a href="#脚注">脚注</a></li>
</ul>
      </div>
    </div>
    

    <div class="wrapper">
      <nav class="site-nav">
  
  
  	
  	<a class="page-link" href="/" >About</a>
  	
  
  	
  	<a class="page-link" href="/index/en/index.html" >Articles</a>
  	
  
  	
  	<a class="page-link" href="/index/cn/index.html" >文章列表</a>
  	
  
  	
  
  	
  
</nav>



<article class="post" lang="zh-Hans" itemscope itemtype="http://schema.org/BlogPosting" >

  <header class="post-header">
  <a class="site-title" href="/">
  	
      Zecong Hu&#39;s blog
    
  </a>
  <h1 class="post-title" itemprop="name headline">大四下总结</h1>
</header>




  <div class="post-content" itemprop="articleBody">
    
<style>
  .hide { display: none; }
</style>

<p>系列八篇中的最后一篇。本应在暑假就写完的，结果断断续续拖了整整一年，到现在五字班都毕业了。</p>

<p>请允许我先用几个词概括我的大四下：</p>

<ul>
  <li><strong>忙碌。</strong>在我的想象中，毕设不过就是几个大作业的分量，大四下应该比较轻松才对。实际的体验却并非如此。</li>
  <li><strong>淡出。</strong>四年来习以为常在身边的同学们，并不是像文学作品中那样，在毕业典礼之后有说有笑相互道别的。在北京工作的同学们在学期中就逐渐搬出了宿舍，其他同学则在毕业后清理了寝室，陆续离开了。这种退场方式，相比起前者更加令人感到难过。</li>
  <li><strong>不舍。</strong>毫不夸张地，这四年是我至今的人生中最丰富多彩、也最专注耐心的四年。有欢笑，有伤心，有许多长进，也有诸多遗憾。</li>
</ul>

<p>tl;dr: 以上就是本篇文章的主旨。赶时间的话，读到这里就可以了。下文中有大量图片，请注意流量。</p>

<!--more-->

<h2 id="毕设">毕设</h2>

<p>我们系的毕设其实挺烦的。既不能用实习替代，也不能在其它院系或者学校完成。加之，之前没有进过实验室、没有提前套磁的同学会被随机分配导师，可以说是惊险刺激。图1展示了一位不幸中招的同学。我因为提前和导师商量好了，所以没有如此惊险刺激的体验，可喜可贺。</p>

<p><img src="/assets/images/2019/08/26/my-8th-semester-in-college/徐老板xilinx.jpg" alt="徐老板xilinx" width="300px" /></p>
<blockquote>
  <p>图1： 被随机分配到网络所的徐老板。大家想起了大三上被造计算机支配的恐惧，纷纷献上 Xilinx ISE 的祝福。</p>
</blockquote>

<p>我对毕设整体持有较为负面的态度。明明培养方案中完全没有涉及科研的部分，却要让大家在最后一学期完成一项学术研究并撰写篇幅极为冗长的论文。然而，这一要求看似严格，但实际上标准却极其宽松，哪怕到最后写出来的只是文献综述也能通过。毫不夸张地说，只有少数人能完成一份真正有价值的学术论文，大多数人（包括我在内）生产出来的都是学术垃圾，在过程中学习到的无非就是如何将垃圾包装为论文而已。</p>

<p class="hide">另一方面则是老师们对毕设的态度，那就是：不在乎。诚然有不少老师是认真对待学生们的毕设的，但从我带偏差的采样的结果来看，有近乎一半的老师是不管事的。学生做了什么，写了啥，与我何干？就如同系里一部分老师对待教学的态度一样，于我无益的事情，我为什么要上心呢？开题时得不到指导，过程中得不到监督，结束时得不到评价。这样的毕设，意义何在？</p>

<p>说得有点过分，但这是我真实的想法。我对自己的毕设也完全不满意，但另一方面也庆幸没有投入更多精力做自己根本不想做的事。因此，下面的流水账记录了我在毕设中划水吃瘪的过程。</p>

<h3 id="开题">开题</h3>

<p>开题的时间其实是大四上的期末。从美国回来后，我和导师谈了谈选题的事。实验室最年长的 PhD 即将毕业，而他毕业后准备创业做法律 NLP，因此导师也希望我毕设能做这方面的东西。具体来说有三个选题，分别是类案匹配、法律领域的网络表示学习，以及法律事件抽取。</p>

<p>说实话，我之前只做过语言模型和词/句表示，对这三个方向我都一无所知，而且总的来说都不是很感兴趣。相比之下我觉得第一个课题要<ruby><rb>好</rb><rt>水</rt></ruby>一点，于是选择了第一个。最后确定下的题目是《面向法律文书与新闻语料的跨领域语义匹配》。</p>

<p class="hide">但实际上，这个题目的正确解读应该是《面向答辩的无监督实验设计与论文写作》。这是后话了。</p>

<h3 id="寒假">寒假</h3>

<p>寒假我们全家到了海南避寒。值得一提的是，我们所在的五指山市，是一个完全看不到海，连电影院也没有，房价比长沙还低的国家级贫困县。不过这里四季温暖如春，没有空气污染，十分适合养老。我每天的娱乐活动就是上网和在小区里散步。</p>

<p>虽然开题时列的进度安排里写的是“寒假期间完成文献调研”诸如此类，但是寒假中一点活也没干。需要说明的是，这并不代表毕设真的很水。恰恰相反，这个题目其实一点也不简单，至少对于我这个完全没做过信息抽取的人来说是这样。</p>

<p>首先，我手头的数据只有实验室之前从网上爬下来的大量法律文书而已。那么第一，我得自己获得一些新闻语料，这意味着写爬虫。第二，除非有什么有用的无监督方法，我还得找人标数据，这意味着写数据标注网站。</p>

<p>其次，不知道大家有没有读过法律文书。这是一种文本量巨大，虽然有明确格式要求但仍然乱得一塌糊涂，到处都是错别字，连“中华人民共和国”都能写错<sup id="fnref:case-docs"><a href="#fn:case-docs" class="footnote">1</a></sup>的文本数据。而且，实验室的数据量实在是太大了，存成 JSON 格式总共有 230G。230G 的文本。</p>

<p>最后，我错误估计了题目的难度。这导致我在上半学期极其散漫，每周组会进度堪忧，中期答辩后每天活在毕不了业的恐惧之中。不过这是也后话了。</p>

<h3 id="中期答辩">中期答辩</h3>

<p>正如上文所述，前半个学期完全是荒废过去的。虽然每天也有在干活，但是在咖啡厅悠闲地干活和一般意义上的干活是完全不同的两种状态。总之，到中期答辩为止，我只是把新闻数据爬了下来，然后对文书稍微做了一下预处理而已。</p>

<p>在这种几乎什么都没做的状态下，迎来了中期答辩。我还记得中期答辩的头一天晚上，在校门口的咖啡厅刷夜准备。回忆起来，真的是十分痛苦。怎么形容呢？明知已无济于事，却还得垂死挣扎；明知自己做的事情百无一用，却只能硬着头皮做下去。痛苦的并不是加班干活，而是加班干没有意义的活。</p>

<p>另一方面的压力来源于系里的规定。虽然心里清楚，毕设做得再怎么差劲也不至于毕不了业<sup id="fnref:cannot-graduate"><a href="#fn:cannot-graduate" class="footnote">2</a></sup>，但传言说中期答辩太差会被发黄牌，然后保送全系答辩<sup id="fnref:yellow-card"><a href="#fn:yellow-card" class="footnote">3</a></sup>。全系答辩的设定是这样的：在最终答辩之后，每个组会选表现倒数的若干名同学送到全系进行<del>公开处刑</del> <del>死刑复核</del>第二轮答辩。再怎么说，我也不希望这件事发生在自己身上。</p>

<p>那天应该是三点多才回到寝室。第二天早上七点就起床准备答辩。万幸的是，那天我的导师不在。前面的同学一个个上场，每个人做得都比我多。到我讲的时候，虽然我努力将自己的工作吹嘘了一番，但和其它人相比也底气不足。奇迹般地，不知道是不是我吹得比较成功<sup id="fnref:successful-boast"><a href="#fn:successful-boast" class="footnote">4</a></sup>，老师们觉得项目难度挺高，就没有深究我的工作量到底有多少。</p>

<p>不过越是装逼，就越会发现装逼的能力是有极限的。下一次组会的时候，导师来了。不凑巧的是，这天是倩倩的生日，因为相关的安排我必须提前从组会离开。火上浇油的是，之前从实验室同学处了解，导师在看到上一周的周报<sup id="fnref:weekly-report"><a href="#fn:weekly-report" class="footnote">5</a></sup>后对和我一样在大四下还选了两门专业课的人非常恼火。或许这就是对我划水的惩罚吧。</p>

<p>对此，我选择的态度是：认怂。提前承认错误，并在被训话时虚心接受。果不其然，导师对我的进度十分不满，但训斥归训斥，还是允许我提前离开了。代价就是，我承诺之后每天在实验室认真干活。不过至少，生日是过成了。</p>

<h3 id="下半学期">下半学期</h3>

<p>自那以后，我每周工作日几乎都在 FIT 楼度过了。早上搭乘四年间头一次乘上的校园巴士（自行车在四月的一次大风中遗失）来到 FIT 楼，中午在五道口吃饭，到晚饭时间再回到寝室。其实也是正常的一天工作，但对我来说尤为煎熬，因为：我真的很讨厌这个题目；而且，FIT 楼处于一种废土状态，非常不适合生存，如图2所示。</p>

<p><img src="/assets/images/2019/08/26/my-8th-semester-in-college/fit废墟.jpg" alt="fit废墟" /></p>
<blockquote>
  <p>图2：FIT楼装修实况。炎炎夏日也<a href="https://github.com/meta-inf/are-FIT-ACs-on">没有空调</a>。</p>
</blockquote>

<p>我之前做文献调研的时候，完全没有找到相关的工作。绝大多数法律相关的工作都是判决预测或者法律问答，即便是英美法系的类案推荐也没找到什么论文；一般的语义相似度的模型则根本不会考虑如此长的文本。在胡思乱想后，我确定的思路是分两步 coarse-to-fine 地做，第一步从所有文书里找到排名前10的，第二步做重排序。如果第二步想用炼丹解决，那么就得收集相应的数据。让标注人员从所有文书中找到最相似的必然不现实，因此只能以第一步的结果作为候选，让标注人员从中选择最优匹配。这意味着第一步得用无监督的方法。但是面对这种长度的文本，传统的提取关键词的方法效果非常平凡，尝试的一些新方法也不奏效。不仅如此，文书的数据量极大而且格式混乱，使得我在预处理上花了非常久的时间。</p>

<p>当然，到头来还是我自己经验不足。比如，我到很后面才知道有这么个叫 ElasticSearch 的东西，可以解决我遇到的很多问题。总之，这段时间我基本上如图3所示。这一段时间是我大四下最压抑的一段时间。正如前面所说，做毫无意义的事情是痛苦的，而这件毫无意义的事情如果还难做，则是雪上加霜。</p>

<p><img src="/assets/images/2019/08/26/my-8th-semester-in-college/放弃思考.jpg" alt="放弃思考" /></p>
<blockquote>
  <p>图3：当我在做毕设时，我在想什么。</p>
</blockquote>

<p>这一步做完之后就好多了。之后我花了一个星期，基于 Django Admin 造了一个数据标注的网站。这一周对我来说简直是救赎，写工程代码比写什么破毕设舒服多了。之后则是标数据相关的杂事，比如拉群宣传、回答标注人员的问题、维护网站<del>并且不手抖删库</del>、垫付标注费并一个一个转账给标注人员。对，标注费要我自己垫付。一共花了一万多，多亏实验室师兄赞助了我一半的钱。</p>

<h3 id="论文撰写">论文撰写</h3>

<p>写论文也是令人头疼的一部分。虽然没有明确的字数要求，但根据流传的几份上古论文和坊间传说，最好能达到40页。字数其实不是问题，毕竟用了炼丹的方法，背景介绍想怎么展开都行（“长短时记忆神经网络是由 Hochreiter 和 Schmidhuber 在 [233] 中提出的一种神经网络结构……”）。问题是写得烦，因为所有人都知道，写出来的这份玩意儿没有人会看，导师也好答辩委员会也好，都不会看。</p>

<p>为了调节心情，大家分分干起了各种与目的无关的事情，比如寻找搞笑的凑字数方法（图4），编写 QQ 群查重 DDL 小助手（图5），或者（仅对我而言）研究各种 <a href="https://tex.stackexchange.com/questions/436689/shifting-baseline-of-cjk-characters">LaTeX 小技巧</a>，以及。但正如图6中所述，这本质上都是在拖延。</p>

<p><img src="/assets/images/2019/08/26/my-8th-semester-in-college/凑字数.jpg" alt="凑字数" width="400" /></p>
<blockquote>
  <p>图4：第 1.3.2 节  机械键盘与写作质量的关系</p>
</blockquote>

<p><img src="/assets/images/2019/08/26/my-8th-semester-in-college/qq群bot.jpg" alt="qq群bot" width="400" /></p>
<blockquote>
  <p>图5：大家好，我是本群的提醒查重 DDL 小助手，希望此刻看到消息的人可以和我一起来写论文。</p>
</blockquote>

<p><img src="/assets/images/2019/08/26/my-8th-semester-in-college/黄老板朋友圈.jpg" alt="当你拖延的时候" width="400" /></p>
<blockquote>
  <p>图6：一句经过转述的真理。</p>
</blockquote>

<p>为了让身边的人顺利毕业，我在寝室中设立了如图7的死亡倒计时。现在看着可能觉得没什么，在当时的环境下可是十分触目惊心的。最终，所有人都可喜可贺地在查重 DDL 前凑出了像样的页数。</p>

<p><img src="/assets/images/2019/08/26/my-8th-semester-in-college/死亡倒计时.jpg" alt="死亡倒计时" /></p>
<blockquote>
  <p>图7：死亡倒计时。</p>
</blockquote>

<p>印象比较深刻的是查重 DDL 的前一天晚上，我2点从校门口的桥咖啡<sup id="fnref:bridge-cafe"><a href="#fn:bridge-cafe" class="footnote">6</a></sup>回寝室。回来发现大家都没睡，都在进行最后的挣扎（或是看大家进行最后的挣扎）。我正好写完，于是在大家的注视下用了个第三方平台查重了一下。出结果后，大家凑过来看了看，随即哄笑起来，寝室里充满了快活的空气。我被查出来重复比较严重的部分有：</p>

<ul>
  <li>“俗话说，‘没有规矩，不成方圆’。法律作为约束人们行为的规范，是巩固政权，维护社会秩序的必要手段。”</li>
  <li>“本院认为，被告人某某某违反国家有关野生动物保护法规，非法出售国家II级重点保护野生动物大壁虎，其行为已构成非法出售珍贵、濒危野生动物罪。判决如下：判处有期徒刑十年。”</li>
  <li>“朴素贝叶斯分类器（naïve Bayes classifier）是最简单的分类模型之一。”</li>
  <li>“实验结果显示，我们的模型在任务上取得了不错的效果。”</li>
</ul>

<p>不得不承认，第一句话确实是我抄的，第二部分也确实是原文，但剩下的都不太讲道理。我们在屏幕前笑得前仰后合，随后开始相互奇文共赏，分享写论文过程中难得的快乐。</p>

<p>查重结束并不代表毕设就做完了。我送去查重的版本缺了大概三分之一的实验结果，而这些实验的代码我甚至还没写。我们组是最早答辩的，因此在仅剩的几天里，我只能一边看着大家划水，一边生死时速亡命实验。同时，这也说明了我做的东西有多水：写代码加跑实验，一共只要三天。</p>

<h3 id="最终答辩">最终答辩</h3>

<p>最终答辩其实没什么可以说的。因为我的工作比较分散而肤浅，所以我可以每部分讲一点而又不用讲得很深入，反而具有非常好的装逼效果。总之，最后无功无过，于我而言是最好的结果了。</p>

<p class="hide">值得一提的是，在答辩一个半小时前，我突然收到一条答辩组的通知，说因为答辩总时间不够，每个人的展示时间从10分钟缩短为8分钟。合着一开始安排答辩的时候没数人数？这真是我大学四年来做展示遇到的最令人窒息的操作。类似的操作还有，同学赶到答辩的教室，发现教室被拆了，一看群才知道临时改地点了。</p>

<p>至此，毕设终于平安无事地画上了一个句号。</p>

<p class="hide">至于这个工作到底有没有意义，实验室会不会有人接着做下去，就是另一回事了。</p>

<h2 id="生活">生活</h2>

<h3 id="寝室">寝室</h3>

<p>正如一开始所说，身边的同学是渐渐淡出我的生活的。上学期期末的时候，天龙率先正式搬离寝室，和王老师合租住进了华清嘉园。那天我回到寝室，看到原本被天龙的组合柜占据的中厅一角变得空荡荡的，竟然觉得有些不舍。其实华清嘉园到寝室不过两公里，平时也能经常聚会，但是和在寝室的感觉是完全不一样的。原本约吃饭只是回个头的事，现在必须网上联系了。</p>

<p>第二个搬离宿舍的是隔壁的韦师，这一下就少了一员吹逼的大将。以往韦师总是会深夜来我们寝室侃天侃地，谈一些只有我们俩会感兴趣的技术话题。不得不说，很多学习曲线陡峭的技术（如 vim 和 git 的高端操作），都是韦师在吹逼中带我入门的。也是在写下这一段的时候我才意识到，已经很久没有人和我讨论各种语言中的黑科技了。</p>

<p>第三个搬离宿舍的是钦老板。钦老板是个非常有娱乐精神的人，在寝室的时候为大家传播和创造了许多梗。说实话，我与钦老板平日的交集算不上多，但有他在的寝室还是要热闹许多。</p>

<p>当然，寝室的人员变动也并不只有搬出。苏老板因为自己寝室条件恶化，在学期中搬来了我们寝室，征用了天龙的位子。苏老板寝室这件事也让我体会到，能有志趣相投、三观相似的室友是多么难得的事情。也正是因此，我们寝室才能成为我们这帮人的“餐饮娱乐中心”<sup id="fnref:recreation-center"><a href="#fn:recreation-center" class="footnote">7</a></sup>，我才能拥有如此精彩而欢乐的大学四年。</p>

<h3 id="日常">日常</h3>

<p>大四下的日常，主要就是毕设和谈恋爱。毕设的部分讲过了，谈恋爱的部分不准备讲，所以日常没什么好讲的了。不过值得一提的是，这学期看了不少演出。在新清看了《吉赛尔》，在蒙民伟看了《第十二夜》和两场《Rent》，在天桥剧场看了《深夜小狗离奇事件》，还在北京喜剧院看了《雅各比与雷弹头》。虽然还是没什么鉴赏能力，但确实能从话剧和音乐剧中体会到乐趣，也算是有进步吧。</p>

<p>剩下还有一些日常聊天的截图，我觉得非常有意思，在这里一并发出来：</p>

<p><img src="/assets/images/2019/08/26/my-8th-semester-in-college/thulaw.jpg" alt="实验室刺激日常" width="400" /></p>
<blockquote>
  <p>图8：法律 NLP 的刺激日常。</p>
</blockquote>

<p><img src="/assets/images/2019/08/26/my-8th-semester-in-college/被申请逼疯.jpg" alt="被申请逼疯" width="600" /></p>
<blockquote>
  <p>图9：被申请逼疯的留学党。</p>
</blockquote>

<p><img src="/assets/images/2019/08/26/my-8th-semester-in-college/如何清理git仓库.jpg" alt="git骚操作" width="400" /></p>
<blockquote>
  <p>图10：如何清理你的 git 仓库。</p>
</blockquote>

<h3 id="学习">学习</h3>

<p>这学期我还有两门大三下退的课：操作系统和计算机系统结构。此外，我还担任了OOP的助教。</p>

<h4 id="操作系统">操作系统</h4>

<p>其实我对这课还是有兴趣的，而且也学到了东西，最后分数也不算差。回头想想，大三下退这门课其实挺没必要的。操作系统的难点在于它的学习曲线非常陡峭，知识点散而杂，要完成第一次作业就得了解很多概念，很多人（包括曾今的我）就因此被劝退了。但说实在的，作为计算机体系里的重要组成部分，操作系统是十分有必要学习的，对于底层优化也能起到指导作用。</p>

<h4 id="系统结构">系统结构</h4>

<p>大三下因为觉得学的东西太傻逼而退课。这学期选了另一个老师开的课，发现内容同等傻逼，而且也有签到环节。布置作业的方式也直逼徐明星，反正就是不知道要做的是哪些题，你得上课去才明白。作业全都是抄的，考试也不难，稍微复习一下就行。</p>

<p>这门课一度打消了我对系统结构的兴趣。直到我上学期（研一下）在 CMU 上了一门并行计算课，其中也有相似的内容，我才发现，这玩意并不枯燥，也不难理解，以前学得那么痛苦纯粹是 PPT 做得太差。说实话，我并没有觉得美帝老师的平均讲课水平比国内高，但在对待课程的认真程度，和课件的精致程度上真的要高出一个档次。</p>

<h4 id="oop助教">OOP助教</h4>

<p>当助教其实挺有意思的，能够切身感受到长江后浪推前浪。好几个组的大作业真的震撼到我了，比如有支持高阶导数的计算图，还有支持闭包、能编译到字节码的简易 Python 解释器（最骚的是他们还自己<em>手写</em> 了 lex 和 yacc）。当然大家的水平差距还是挺大的，也有被我打了接近零分的脑残大作业。</p>

<p>助教的另一个工作就是出考卷和批考卷。因为我们系 OOP 课程很重要的一个内容是学习高端 C++ 特性，所以考试题目大部分都是在考察 C++ 知识。考前我们会聚在一起讨论题目有没有什么漏洞，大家都觉得没毛病的题才会往试卷上放，但即便如此，也经常会漏掉一些 corner case。比如说，下面是一道考试原题：</p>

<blockquote>
  <p>以下说法不正确的是：</p>
  <ol style="list-style-type: upper-latin;">
<li>被声明为友元的函数或类，对出具友元声明的类的一切成员有访问权限。</li>
<li>A 函数是 B 类的友元函数，B 类是 C 类的友元类，A 函数对 C 类没有特殊访问权限。<br /></li>
<li>编译器认为某个函数不值得内联，就会忽略内联修饰符。<br /></li>
<li>编译期间建立虚函数表 VTABLE 和虚函数指针 VPTR。</li>
</ol>
</blockquote>

<p>其实看题很容易想明白想考察的知识点是什么。A 是友元的定义，B 是友元关系不具有传递性，C 是 inline 不是强制内联，D 是虚函数机制的实现。只有 VTABLE 是编译期建立的，VPTR 是运行时在构造函数里赋值的，所以答案是 D。但考试结束后，同学们指出 A 和 C 也存在错误。A 是因为出具友元声明的类可能包含其自身也无法访问到的成员，比如其父类的私有成员；C 是因为内联修饰符 inline 有另一个语义，即函数不会跨翻译单元，而这一语义是不会被忽略的。怎么说呢，C++ 是真能锻炼记忆力和思辨能力的。</p>

<p>除此之外，助教的工作包括做课件、布置作业、改作业等等。我自认为课件做得还不错。我负责的是单例和工厂模式的部分，介绍了单例相关的争议、CRTP，以及工厂模式的一些现实例子。我当时学设计模式的时候就苦于没有实际应用，每看一个模式都只会觉得“这个有啥用”。希望结合自身学习经历做出来的课件能帮到一些学弟学妹吧。</p>

<h3 id="女生节">女生节</h3>

<p>不知道前文中是否提过，我们班大四的班长是曾任大三副班长的白教员。虽然大家常常拿他打趣，但不可否认的是，在没人愿意管事的大四学年<del>连任</del>接下了班长的摊子，就已经很了不起了。</p>

<p>我们班的女生节活动是前往古北水镇游玩。女生们其实不太满意，因为二班在一周前刚去过，白教员的灵感从何而来比较明显。但对我来说，去哪玩不重要，和班里同学这多半最后一次的活动才重要。</p>

<p>过程没什么可说的，放一张爬司马台长城的图吧。</p>

<p><img src="/assets/images/2019/08/26/my-8th-semester-in-college/女生节.jpg" alt="女生节" width="700" /></p>
<blockquote>
  <p>图11：最后一次班级活动的合照。</p>
</blockquote>

<h3 id="马拉松">马拉松</h3>

<p>趁毕业前挑战了一次校园半马。之前跑过两次 10km，感觉虽然累但也能撑下来，可这次半马就完全不一样了。前 10km 觉得还比较轻松（甚至比去年快），但从第 13km 开始就感到体力不支，从 16km 开始感觉右腿膝盖有点疼，最后 3km 走一阵跑一阵，咬牙坚持才跑完的。跑下来一共2小时40分，属于重在参与的成绩。</p>

<p>这次跑完之后腿疼了好一阵子，具体表现是右腿膝盖不能在弯曲的时候用力，比如上楼时不能用右脚做支撑。为此，我发明了一种特殊的上楼方法：左脚处于比右脚高两级台阶的位置，随后每上一级台阶时，左脚先上一级，然后右脚再上一级。那阵子只有用这种方法上楼腿才不会疼。令我没想到的是，这次腿疼的影响远高于我的预期，直到半年之后才完全复原。看来还是不能盲目挑战要求比较高的运动。</p>

<h3 id="毕业旅行">毕业旅行</h3>

<p>出于一些原因，我们班的毕业旅行没搞起来。白教员尽心尽力准备了几套旅行方案，但无奈参与的人数过少，只好遗憾作罢。</p>

<p>但再怎么咸鱼，旅行还是要旅行的。我们几个平时玩得好的决定自驾游去附近的城市。经过一些讨论和放鸽之后，我们决定租两辆车开去北戴河。出行前，我和另外两位司机被按在椅子上接受了<a href="https://space.bilibili.com/28152409/video">交通事故video</a>的安全教育。</p>

<p>我们的旅行其实没啥亮点。死宅自驾出游会带什么？两台 PS4、一台 Switch、两盒方便火锅。这些东西塞满了后备箱。一路上的过程就是：开车吹逼，下车吃饭，到旅馆打游戏。不得不说北戴河的住宿是真的便宜，我们定了两间复式公寓，目测每间有差不多100平，一晚上才二百来块。我们也没去什么景点，就在海边吹了吹风，沙滩上躺了躺，然后回房间玩游戏去了。听着很咸鱼，但对我们来说就是快乐的本质。</p>

<p>旅行没拍什么游客照，拍的全都是大家的表情包和鬼畜视频，所以不放图了。</p>

<h3 id="毕联">毕联</h3>

<p>虽说带有浓厚的主观滤镜，但我还是认为，我们这一届毕联是近几年来最棒的，没有之一。这届毕联的主题是《天下大计》，是一个颇有页游风格的霸气名字。按照官方说法，这个名字的含义是“计4年级即将毕业，前往世界各地的工作岗位上担起自己的职责”，而且还“与去年毕联主题‘酒歌烁世’<sup id="fnref:nine-masters"><a href="#fn:nine-masters" class="footnote">8</a></sup>形成呼应，我系同学将继续学长学姐所留下的优秀文化，不忘初心不忘使命”。玩笑归玩笑，我还是很喜欢这个名字的，有一种敢为天下先的豪迈感。</p>

<h4 id="毕联筹备">毕联筹备</h4>

<p>三月底，我被唐主席连哄带骗拉进了毕联筹备组，帮着做一些宣传方面的事情。刚开始做的事情就是传统的宣传，比如做宣传图、印刷品、<a href="https://mp.weixin.qq.com/s/EitnSclgpnwJlMIYT5U2bg">纪念衫</a>等等。其中诞生出的一个非常不错的点子是毕业倒计时：把大学四年中的重要事件映射到毕业前的100天内，在公众号上推倒计时图片。图片下方的装饰线其实藏着进度条，只有把图片连着看的时候才会发现。美中不足的是最开始的十几张图用的模板有些小偏差，导致最下方的文字位置有微小的偏差。</p>

<p>我把所有图片压成了下面的视频。这些图片最后变成了毕业纪念册里的每一页。</p>

<video src="/assets/images/2019/08/26/my-8th-semester-in-college/倒计时.mp4" autoplay="" muted="" loop=""></video>

<h4 id="毕联游戏">毕联游戏</h4>

<p>我本来以为我的任务就是帮着一起做图而已。直到四月底的有一天，唐主席和家晖把我带到 408 单独约谈，说既然毕联的名字这么像一个游戏，不如我们真的做一个游戏吧；组委会都决定了，我来当负责人。我本来想说另请高明吧，但仔细想了想，这游戏听着真的挺有意思的，而且我真的需要一些事情来缓解毕设带来的枯燥感，就接下了这口重锅。</p>

<p>我们准备做一个文字冒险游戏（因为其它所有类型都不太现实），讲述从入学到毕业<sup id="fnref:completion-not-graduation"><a href="#fn:completion-not-graduation" class="footnote">9</a></sup>的故事。最后的成果就是这个网站首页上的<a href="http://cst4.zecong.hu/">天下大计</a>同名游戏。游戏发布后获得了很高的热度，许多毕业多年的学长学姐都在玩，甚至还有同学熬夜肝这个游戏，真实爆肝。游戏上线后也暴露出了一些测试中没有发现的 bug，给了我在生产环境部署 hotfix 的宝贵体验。</p>

<p><img src="/assets/images/2019/08/26/my-8th-semester-in-college/天下大计-调试.jpg" alt="天下大计调试现场" width="400" /></p>
<blockquote>
  <p>图12：艰苦卓绝的调试现场。</p>
</blockquote>

<p>当然，这绝非我一人的功劳。非常感谢天天被我 push 的编写和测试剧本的同学们、统筹的唐主席、担任美工的家晖，以及两篇非常优秀的<a href="https://mp.weixin.qq.com/s/qCZGCDGEsSIvSKvdfc2D2A">宣传推送</a>和<a href="https://mp.weixin.qq.com/s/lDRfz1xPTvD-L1fLu1oVWQ">攻略推送</a>。这是我大四一整年参与过的所有涉及写代码的项目中，最有成就感的一个。</p>

<h4 id="毕联晚会">毕联晚会</h4>

<p>毕联晚会还是不错的，诞生了一些新的表情包，还有不少人看乔导的采访视频都看哭了。但对我来说重点是之后的聚餐。一如往常，聚餐在南门外的满盆香<sup id="fnref:man-pen-xiang"><a href="#fn:man-pen-xiang" class="footnote">10</a></sup>。这是我喝得最多的一次（对于酒量极小的我来说，这大概是两瓶啤酒），也是最开心的一次。这次也让我见识到了大家酒后的百态，包括哭得稀里哗啦的殷老师，不敬酒自己也喝的徐子南，以及喝前矜持喝后到处灌人酒的酒品贼差的白教猿。</p>

<p>最后实在是不胜酒力，还是倩倩骑电动车送我到楼下，然后喊室友搀扶着我上楼的。</p>

<h2 id="旅途的终点">旅途的终点</h2>

<p>毕业的流程全部压缩在了最后一周内。这里我打算按照时间顺序，以流水账的形式回顾一下到毕业为止发生的事情：</p>

<p>7月4日，刚刚结束毕业旅行，回来就是毕业联欢晚会和毕业聚餐。如前文所述，晚上聚餐喝得太多，回到寝室之后倒头就睡。</p>

<p>7月5日，起床之后晕乎了一上午。下午出门买了第二天合影要穿的白衬衫。晚上和大家出去唱歌到了两点，唱的都是这四年来次次会点的怀旧金曲。</p>

<p>7月6日，拍了一整天的照。一大早起来和校领导合影，随后紧接着是系毕业典礼，然后是系里的合影。系里合影拍了一个扔学士帽的版本，大家都笑成了表情包。下午拜托王老师帮我和倩倩拍了一组毕业纪念照。顺带一提，这组照片到现在还没修完。</p>

<p>7月7日，下午和实验室的导师和同学合影。没想到大家都穿了学士服，就我一人穿了T恤。爸妈也在这天来了北京，晚上一起吃了饭。回来之后终于开始整理房间了。</p>

<p>7月8日，校毕业典礼。发言比较冗长，于是我们几个玩起了你画我猜。六核十二线程拨穗<sup id="fnref:multiprocess"><a href="#fn:multiprocess" class="footnote">11</a></sup>结束之后，我和倩倩两家人共进了午餐。午餐比想象中的顺利，两家人似乎都对对方比较满意，也没有什么“我才不会把女儿交给你”之类的动漫定番。</p>

<p>7月9日，跑各种毕业的手续。领了证书、照片，和纪念品，注销了校园卡和网络账号，还了宿舍钥匙，交了离校表。晚上和大家吃了临走前最后一顿聚餐，回来之后抓紧最后的时间清东西。408 被大家带不走的或有用或没用的东西给塞满了，俨然成为了有求必应屋。</p>

<p>7月10日，搬离宿舍，下午就回到了家。这个过程实在是太突然，以至于我还没有反应过来“是真的毕业了”，就已经到家了。这几天满当当的流程，以及穿插其中的清东西，让我完全没有时间因毕业而感伤。直到回家后闲下来了，情绪才一下子涌了上来。</p>

<p>该怎么说呢，对很多人来说高中是他们的青春，但我的高中生活几乎只有竞赛，大学才是我的青春。上大学之前的我是一个没有住过校、没有加入过社团组织、没有参与过年级活动的人，所以我才会说<a href="/2015/02/06/my-1st-semester-in-college/#%E7%8F%AD%E7%BA%A7%E5%92%8C%E5%90%8C%E5%AD%A6%E4%BB%AC">大学的班级真正给了我归属感</a>。大学让我体会到了太多的第一次，包括<a href="/2017/01/28/my-5th-semester-in-college/#%E6%96%87%E8%89%BA%E9%83%A8">参与组织学生活动</a>、<a href="/2016/02/11/my-3rd-semester-in-college/#%E5%AD%A6%E7%94%9F%E8%8A%82-1">当 DV 剧导演</a>、<a href="/2016/02/04/se-project-dev-log/">和信任的小伙伴</a><a href="/2017/01/28/my-5th-semester-in-college/#fpga-%E8%AE%BE%E8%AE%A1%E5%A4%A7%E8%B5%9B">合作完成项目</a>、<a href="/2018/07/19/my-7th-semester-in-college/#%E6%9A%91%E7%A0%94">出国交换</a>等等。除了这些体验之外，大学最宝贵的财富就是收获了一群志同道合的好朋友，我从他们身上学到的东西，不少于我从课本上学到的。</p>

<p>“丰富多彩，专注耐心”是我大一入学时辅导员告诉大家的一句话。回顾这四年的生活，我觉得我能对得起这句话。接下来要做的事，大概就是忘掉大学期间取得的成就，走出象牙塔，寻找并实现人生的下一个目标。</p>

<p><br /></p>

<p>大学生活，就此结束。</p>

<p><img src="/assets/images/2019/08/26/my-8th-semester-in-college/合影-计算机本科生.jpg" alt="毕业合影" /></p>
<blockquote>
  <p>图13：计四年级毕业合影。</p>
</blockquote>

<p><br /></p>

<h2 id="脚注">脚注</h2>

<div class="footnotes">
  <ol>
    <li id="fn:case-docs">
      <p>这是真的。我在数据中见到的错误写法有：<a href="http://wenshu.court.gov.cn/content/content?DocID=fda83995-0b05-4d4a-a3a8-4a2538558838&amp;KeyWord=%E6%9C%80%E9%AB%98%E4%BA%BA%E6%B0%91%E5%85%B1%E5%92%8C%E5%9B%BD">最高人民共和国</a>、<a href="http://wenshu.court.gov.cn/content/content?DocID=4dc977b9-e0d4-4e42-9afa-160221895b41&amp;KeyWord=%E5%B1%AE%E5%8D%8E%E4%BA%BA%E6%B0%91%E5%85%B1%E5%92%8C%E5%9B%BD">屮华人民共和国</a>、<a href="http://wenshu.court.gov.cn/content/content?DocID=45b4fee2-2eae-49df-affa-70464606e77e&amp;KeyWord=%E4%B8%AD%E5%9B%BD%E4%BA%BA%E6%B0%91%E5%85%B1%E5%92%8C%E5%9B%BD">中国人民共和国</a>、<a href="http://wenshu.court.gov.cn/content/content?DocID=7906e93b-8bf4-46c1-a433-943f5a5f631a&amp;KeyWord=%E4%B8%AD%E5%9B%BD%E4%BA%BA%E5%85%B1%E5%92%8C%E5%9B%BD">中国人共和国</a>等等。为了证明不是我瞎编的，可以点击错误写法查看真实的法律文书。 <a href="#fnref:case-docs" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:cannot-graduate">
      <p>事实上并非如此，无法达标的话是真的毕不了业的。虽然标准相当低就是了。 <a href="#fnref:cannot-graduate" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:yellow-card">
      <p>事后证明这只是传闻而已。不过期中表现太差确实会让导师盯住你。 <a href="#fnref:yellow-card" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:successful-boast">
      <p>并不是。其实只是因为，只要划水不太过分，中期答辩都不会被追究进度。 <a href="#fnref:successful-boast" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:weekly-report">
      <p>“本周进度：复习操作系统期中考试。” <a href="#fnref:weekly-report" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:bridge-cafe">
      <p>似乎毕业后不久就关门了。这么说来我也算是最后的客户之一吧。 <a href="#fnref:bridge-cafe" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:recreation-center">
      <p>每当需要聚众吃夜宵或者打游戏，大家就会来我们寝室。 <a href="#fnref:recreation-center" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:nine-masters">
      <p>为不了解背景的各位介绍一下，去年的名字是实际上在暗讽系里硕士缩招，只有“九个硕士”名额。 <a href="#fnref:nine-masters" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:completion-not-graduation">
      <p>如果你真的玩了这个游戏，会发现大部分时候它讲的都是从入学到结业的故事。 <a href="#fnref:completion-not-graduation" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:man-pen-xiang">
      <p>记忆中我每年都来满盆香吃过一次聚餐，分别是大一班级聚餐、大二学生节聚餐、大三学生节聚餐，以及大四毕业聚餐。据说，之所以聚餐都选择这里，是因为它是学校附近唯一能营业到凌晨两点的地方。 <a href="#fnref:man-pen-xiang" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:multiprocess">
      <p>六个台子，每个台子上两名校领导，共十二名领导并行拨穗。 <a href="#fnref:multiprocess" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div>

  <footer class="post-footer">
    <div class="post-meta">
       <time datetime="2019-08-26T15:36:00+00:00" itemprop="datePublished">Aug 26, 2019</time> 
      
    </div>

    
  </footer>

  
  <div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    this.page.url = 'http://zecong.hu/2019/08/26/my-8th-semester-in-college/';
    this.page.identifier = 'http://zecong.hu/2019/08/26/my-8th-semester-in-college/';
  };

  (function() {
    var d = document, s = d.createElement('script');

    s.src = 'https://huzecong-blog.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

  
</article>

    </div>
    <script type="text/javascript">
  (function () {
    var resize = function () {
      this.width = 0.5 * (this.naturalWidth || this.width);
    }
    Array.prototype.forEach.call(document.querySelectorAll(".half-size, .retina2x"), function(el) {
      if (el.naturalWidth) {
        resize.call(el);
      } else {
        el.onload = resize;
      }
    });
  })();
</script>

  </main>

  
<script type="text/javascript">
  // Show tooltips for footnotes.
  (function() {
    const footnotes = document.querySelectorAll(".footnotes > ol > li");
    const returnMarkRegex = /("?&nbsp;<a href="#fnref:.+?" class="reversefootnote">↩(<sup>.*?<\/sup>)*<\/a>)+/s;
    const footnoteMarks = document.querySelectorAll("a.footnote");
    for (let index of footnoteMarks.keys()) {
      if (footnotes[index] === undefined) continue;
      const content = footnotes[index].innerHTML.replace(returnMarkRegex, "");
      const footnote = footnoteMarks[index];
      tippy(footnote, {
        content: content,
        arrow: true,
        animation: 'shift-away',
        interactive: true,
        theme: 'light',
        // trigger: 'click',
        size: 'large',
        touch: false,
        touchHold: true,
      });
    }
  })();
</script>



<script type="text/javascript">
  // Add "active" highlight to TOC on left.
  // Credit: https://codemyui.com/sidebar-menu-scroll-progress-indicator/
  (function() {
    const svg_html = ' \
      <svg class="toc-marker" width="200" height="200" \
           xmlns="http://www.w3.org/2000/svg"> \
        <path stroke="#444" stroke-width="1.5" fill="transparent" \
              stroke-dasharray="0, 0, 0, 1000" stroke-linecap="round" \
              stroke-linejoin="round" transform="translate(-0.5, -0.5)" /> \
      </svg> \
      '
    document.querySelector("#table-of-contents .toc-wrapper").innerHTML += svg_html;
  })();

  // Jekyll renders everything on one level, so nested titles are not actuall
  // nested in the DOM. We need to manually create the levels.
  const contentElems = document.querySelector("article > div.post-content").children;
  // A `tocItem` is a dictionary.
  const tocItems = [].slice
    .call(document.querySelectorAll("#table-of-contents li.toc-entry"))
    .map(function(item) {
      const anchor = item.querySelector("a");
      const subList = item.querySelector("ul");
      return {
        item: item,
        href: anchor.getAttribute("href").substr(1),  // remove '#' prefix
        anchor: anchor,
        subList: subList,
      };
    });
  let tocPointer = 0;
  const validTags = ["H1", "H2", "H3", "H4", "H5", "H6"];
  for (let index = 0; index < contentElems.length; ++index) {
    const elem = contentElems[index];
    if (validTags.indexOf(elem.tagName) !== -1) {
      const level = parseInt(elem.tagName[1]);

      if (tocPointer > 0 && tocPointer <= tocItems.length) {
        tocItems[tocPointer - 1].targetBottom = contentElems[index - 1];
      }

      // Current element matches the next entry in the TOC.
      if (tocPointer < tocItems.length &&
          elem.id === tocItems[tocPointer].href) {
        const curTocItem = tocItems[tocPointer];
        curTocItem.level = level;
        curTocItem.titleElem = elem;
        ++tocPointer;
      }
    }
  }
  // Final TOC items has not yet ended.
  if (tocPointer > 0 && tocPointer <= tocItems.length) {
    tocItems[tocPointer - 1].targetBottom = contentElems[contentElems.length - 1];
  }

  let pathLength;

  const tocPath = document.querySelector('.toc-marker path');

  function drawPath() {
    const path = [];
    let pathIndent,
        topOffset = 0;

    // pathLength = 100000;
    // setActivePath(currentActiveIndex);

    tocItems.forEach(function(item) {
      const x = item.anchor.offsetLeft - 5,
            height = item.anchor.offsetHeight;
      const y = topOffset;

      const parent = item.item.parentNode;
      
      if (!(parent.classList.contains("section-nav") ||
            parent.parentNode.classList.contains("expand"))) {
        // Top-level section.
        item.pathStart = 0;
        item.pathEnd = 0;
        return;
      }

      if (path.length === 0) {
        path.push( 'M', x, y, 'L', x, y + height );
        item.pathStart = 0;
      } else {
        // Draw an additional line when there's a change in
        // indent levels.
        if (pathIndent !== x) path.push('L', pathIndent, y);
        path.push('L', x, y);

        // Set the current path so that we can measure it.
        tocPath.setAttribute('d', path.join(' '));
        item.pathStart = tocPath.getTotalLength() || 0;

        path.push('L', x, y + height);
      }
      topOffset += height;

      pathIndent = x;
      tocPath.setAttribute('d', path.join(' '));
      item.pathEnd = tocPath.getTotalLength();
    });

    pathLength = tocPath.getTotalLength();
  }

  let currentActiveIndex = null;

  function setActivePath(index) {
    // Specify the visible path or hide the path altogether
    // if there are no visible items.
    if (index !== null) {
      const pathStart = tocItems[index].pathStart;
      const pathEnd = tocItems[index].pathEnd;
      if (pathEnd === 0) {
        // no-op
      } else {
        tocPath.setAttribute('stroke-dashoffset', '1');
        // Set dash end to an infinitely large value to avoid
        // accidental repetition of pattern.
        tocPath.setAttribute(
          'stroke-dasharray',
          '1, ' + pathStart + ', '+ (pathEnd - pathStart) + ', ' + 10000000);
        tocPath.setAttribute('opacity', 1);
      }
      // console.log(index, tocItems[index].href, pathStart, pathEnd, pathLength);
    } else {
      tocPath.setAttribute('opacity', 0);
    }
  }

  function setActiveEntryClass(index, className) {
    // Set CSS classes for the current index and ancestors.
    const isActive = Array(tocItems.length).fill(false);
    // Compute heights of each item after expanding here, because `scrollHeight`
    // does not take into account inner height of nested non-expanded lists that
    // will also be expanded next.
    const expandedHeights = Array(tocItems.length).fill(0);

    if (index !== null) {
      let item = tocItems[index];
      let curLevel = Infinity;
      let accumulateHeight = 0;
      for (let i = index; i >= 0; --i) {
        item = tocItems[i];
        if (item.level < curLevel) {
          curLevel = item.level;
          if (item.subList !== null)
            accumulateHeight += item.subList.scrollHeight;
          expandedHeights[i] = accumulateHeight;
          isActive[i] = true;
        }
      }
    }

    const itemsToAdd = [], itemsToRemove = [];
    const addHeights = [];
    for (let i = 0; i < tocItems.length; ++i) {
      const item = tocItems[i];
      if (item.item.classList.contains(className)) {
        if (!isActive[i]) {
          item.item.classList.remove(className);
          if (item.subList !== null) {
            itemsToRemove.push(item.subList);
          }
        }
      } else {
        if (isActive[i]) {
          item.item.classList.add(className);
          if (item.subList !== null) {
            itemsToAdd.push(item.subList);
            addHeights.push(expandedHeights[i]);
          }
        }
      }
    }

    return {
      add: itemsToAdd,
      addHeights: addHeights,
      remove: itemsToRemove,
    };
  }

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // Ticket-based queue.
  let transitionTicket = 0, transitionCounter = 0;

  // Credit: https://css-tricks.com/using-css-transitions-auto-dimensions/
  async function toggleItems() {

    // Empty loop waiting for ticket.
    const ticket = transitionCounter++;
    while (ticket !== transitionTicket) {
      await sleep(100);
    }

    // if (ticket + 1 !== transitionCounter) {
    //   transitionTicket = ticket + 1;
    //   return;
    // }

    // Use the latest active index.
    const index = currentActiveIndex;
    itemChanges = setActiveEntryClass(index, "expand");

    if (itemChanges.add.length === 0 && itemChanges.remove.length === 0) {
      // if (ticket + 1 === transitionCounter) {
        // Only perform callback on final ticket.
        // drawPath();
        setActivePath(index);
      // }
      // Null transition, release ticket.
      transitionTicket = ticket + 1;
      return;
    }

    const firstItem = (itemChanges.add.length > 0 ?
                       itemChanges.add[0] : itemChanges.remove[0]);
    const originalTransition = firstItem.style.transition;
    const allItems = itemChanges.add.concat(itemChanges.remove);

    const targetHeight = itemChanges.addHeights;
    allItems.forEach(item => item.style.transition = "");
    for (let item of itemChanges.add) {
      item.style.height = "0";
    }
    for (let item of itemChanges.remove) {
      item.style.height = item.scrollHeight + "px";
    }
    firstItem.offsetHeight;  // trigger reflow

    requestAnimationFrame(function() {
      for (let i = 0; i < itemChanges.add.length; ++i) {
        const item = itemChanges.add[i];
        item.style.height = targetHeight[i] + "px";
      }
      for (let i = 0; i < itemChanges.remove.length; ++i) {
        const item = itemChanges.remove[i];
        item.style.height = "0";
      }
      allItems.forEach(item => item.style.transition = originalTransition);
      firstItem.offsetHeight;  // trigger reflow

      firstItem.addEventListener('transitionend', function(e) {
        // Event listeners are also fired for children nodes.
        if (e.target !== firstItem) return;
        e.target.removeEventListener(e.type, arguments.callee);
        for (let item of itemChanges.add) {
          item.style.height = "auto";
        }
        for (let item of itemChanges.remove) {
          item.style.height = null;
        }
        firstItem.offsetHeight;  // trigger reflow

        // End of transition, release ticket.
        transitionTicket = ticket + 1;
      });

      drawPath();
      setActivePath(index);
    });
  }

  function updateActive(event, forceRedraw = false) {
    const windowHeight = window.innerHeight;

    // We only allow one entry to be active. This entry must satisfy one of the
    // following conditions:
    // 1. Its section is the only section visible on screen.
    // 2. Its title (`targetTop`) is the first title that is within screen bounds.
    const titlePos = tocItems.map(function(item) {
      return item.titleElem.getBoundingClientRect();
    });
    const targetBottom = tocItems.map(function(item) {
      return item.targetBottom.getBoundingClientRect().bottom;
    });

    let index = 0;
    for (; index < tocItems.length; ++index) {
      if (// Any portion of title is within screen bounds.
          (0 < titlePos[index].bottom && titlePos[index].top < windowHeight) ||
          // Section is the only one on screen...
          (titlePos[index].top < 0 &&
            // ... and is the final section.
           ((index === tocItems.length - 1 &&
             targetBottom[index] > 0) ||
            // ... and the next section title is not completely shown.
            (index < tocItems.length - 1 &&
             titlePos[index + 1].bottom > windowHeight)))) {
        break;
      }
    }
    if (index >= tocItems.length) index = null;

    if (currentActiveIndex !== index || forceRedraw) {
      // console.log("redraw", currentActiveIndex, index, forceRedraw);
      currentActiveIndex = index;

      // setActivePath(index);
      setActiveEntryClass(index, "active");

      requestAnimationFrame(function() {
        toggleItems();
      });
    }
  }

  drawPath();
  updateActive(true);
  window.addEventListener('resize', function(event) {
    updateActive(event, true);
  }, false);
  window.addEventListener('scroll', updateActive, false);
</script>


<footer class="site-footer">

  <div class="wrapper">
    <div class="social-links">
      
      <a class="social-link social-github" href="https://github.com/huzecong">
        <i class="icon-github"></i>
      </a>
      
      
      
      <a class="social-link social-rss" href="/feed.xml" target="_blank">
        <i class="icon-rss"></i>
      </a>
    </div>
    <div class="credits">
      KAGAMI, made with <i class="icon-heart"></i> by Kamikat
    </div>
  </div>

</footer>


</body>

</html>
